<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="theme-color" content="#654321">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Generala Scorekeeper">
<link rel="manifest" href="manifest.json">
<meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' ; connect-src 'self'">
<title>Generala - Anotador</title>
<style>
/* ---------------- ESTILOS ---------------- */
:root {
--color-fondo: #D2B48C;       /* Madera claro */
--color-boton: #654321;       /* Marr√≥n oscuro base */
--color-boton-light: #7a5230; /* Marr√≥n m√°s claro para gradiente */
--color-texto-btn: #FFD700;   /* Dorado */
--color-texto: #3E2723;       /* Marr√≥n muy oscuro */
--color-row1: #C0C0C0;
--color-row2: #FFFFFF;
--color-bordo: #800000;       /* Color eliminaci√≥n */
}
* {
box-sizing: border-box;
user-select: none;
-webkit-tap-highlight-color: transparent;
touch-action: manipulation;
}
body {
background-color: var(--color-fondo);
color: var(--color-texto);
font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
margin: 0;
padding: 0;
height: 100vh;
display: flex;
flex-direction: column;
overflow: hidden;
-webkit-font-smoothing: antialiased;
-moz-osx-font-smoothing: grayscale;
}
/* Pantallas */
.screen {
display: none;
flex-direction: column;
height: 100%;
padding: 20px;
overflow-y: auto;
}
.active {
display: flex;
-webkit-overflow-scrolling: touch;
}
/* Botones Sofisticados */
button {
background: linear-gradient(to bottom, var(--color-boton-light), var(--color-boton));
color: var(--color-texto-btn);
border: 1px solid #3e2723;
border-bottom: 4px solid #2a1a15; /* Efecto 3D */
padding: 15px;
font-size: 1.2rem;
font-weight: bold;
border-radius: 8px;
cursor: pointer;
box-shadow: 0px 4px 6px rgba(0,0,0,0.4);
transition: all 0.1s ease;
text-shadow: 1px 1px 0px rgba(0,0,0,0.5);
outline: none;
position: relative;
-webkit-appearance: none;
-moz-appearance: none;
}
/* Animaci√≥n de presi√≥n agradable */
button:active {
transform: translateY(3px); /* Se hunde */
border-bottom: 1px solid #2a1a15; /* Reduce el borde 3D */
box-shadow: 0px 1px 2px rgba(0,0,0,0.4);
filter: brightness(1.1); /* Brilla un poco */
}
button:disabled {
opacity: 0.5;
cursor: not-allowed;
transform: none;
border-bottom: 4px solid #2a1a15;
}
/* Inputs */
input[type="text"], input[type="password"], input[type="email"] {
padding: 12px;
font-size: 1.1rem;
border: 2px solid #654321;
border-radius: 6px;
background: #fff8e1;
color: var(--color-texto);
width: 100%;
font-weight: bold;
-webkit-appearance: none;
-moz-appearance: none;
}
/* Layouts utilitarios */
.v-box { display: flex; flex-direction: column; gap: 15px; }
.h-box { display: flex; flex-direction: row; gap: 10px; }
.center { align-items: center; justify-content: center; text-align: center; }
.spacer { flex: 1; }
/* --- HOME SCREEN --- */
#home-screen { justify-content: center; gap: 30px; }
.home-title {
font-size: 2.2rem;
font-weight: 900;
text-align: center;
color: #3E2723;
text-shadow: 1px 1px 0px #fff;
}
/* --- MENU SCREEN --- */
.player-row {
display: flex;
gap: 10px;
opacity: 0;
animation: slideIn 0.3s forwards;
margin-bottom: 10px;
}
@keyframes slideIn {
from { opacity: 0; transform: translateX(-20px); }
to { opacity: 1; transform: translateX(0); }
}
.color-btn {
width: 45%;
font-size: 1rem;
padding: 10px;
border-bottom-width: 3px;
/* El color de texto se define inline por JS */
text-shadow: none;
}
/* --- ANOTADOR SCREEN --- */
.turn-label {
font-size: 1.6rem;
font-weight: bold;
margin-bottom: 15px;
text-align: center;
background: rgba(255,255,255,0.3);
padding: 10px;
border-radius: 8px;
border: 2px solid #654321;
}
/* Tabla de puntajes (Grid CSS) */
#score-grid {
display: grid;
gap: 2px;
background-color: #3E2723; /* Color de l√≠neas de divisi√≥n */
border: 4px solid #3E2723;
border-radius: 4px;
overflow: auto;
flex: 1;
box-shadow: inset 0 0 10px rgba(0,0,0,0.5);
}
.cell {
display: flex;
align-items: center;
justify-content: center;
padding: 4px;
font-weight: 800; /* Texto bien grueso */
font-size: 1.1rem;
min-width: 65px;
min-height: 45px;
position: relative;
text-align: center;
}
.cell-btn {
width: 100%; height: 100%;
background: transparent !important;
border: none !important;
box-shadow: none !important;
color: inherit;
font-weight: inherit; font-size: inherit;
cursor: pointer; padding: 0; margin: 0;
position: absolute; top: 0; left: 0;
transform: none !important; /* Desactivar animaci√≥n de bot√≥n est√°ndar para celdas */
}
.cell-btn:active {
background-color: rgba(0,0,0,0.1) !important; /* Feedback visual sutil */
}
.header-col {
background-color: var(--color-fondo);
color: var(--color-texto);
font-size: 0.9rem;
}
/* --- ESTILOS DE JUGADOR ELIMINADO --- */
.dead-cell {
background-color: var(--color-bordo) !important;
color: white !important; /* Texto base blanco sobre bord√≥ para contraste */
position: relative;
}
/* L√≠nea Negra (Diagonal) */
.dead-line-black::after {
content: "";
position: absolute;
top: 0; left: 0; width: 100%; height: 100%;
background: linear-gradient(to top right, transparent calc(50% - 2px), black calc(50% - 2px), black calc(50% + 2px), transparent calc(50% + 2px));
pointer-events: none;
}
/* L√≠nea Blanca (Diagonal - para jugador negro) */
.dead-line-white::after {
content: "";
position: absolute;
top: 0; left: 0; width: 100%; height: 100%;
background: linear-gradient(to top right, transparent calc(50% - 2px), white calc(50% - 2px), white calc(50% + 2px), transparent calc(50% + 2px));
pointer-events: none;
}
/* --- POPUPS / MODALS --- */
.modal-overlay {
position: fixed; top: 0; left: 0; width: 100%; height: 100%;
background: rgba(0,0,0,0.7);
backdrop-filter: blur(2px);
display: none; align-items: center; justify-content: center;
z-index: 1000;
}
.modal-content {
background: linear-gradient(to bottom, #fff, #f0f0f0);
padding: 25px;
width: 90%;
max-width: 400px;
max-height: 85vh;
overflow-y: auto;
border-radius: 12px;
display: flex; flex-direction: column; gap: 20px;
text-align: center;
color: black;
box-shadow: 0 10px 25px rgba(0,0,0,0.5);
border: 2px solid #654321;
}
.grid-colors, .grid-scores, .grid-lang {
display: grid;
grid-template-columns: repeat(3, 1fr);
gap: 12px;
}
.score-val-btn { font-size: 1.4rem; padding: 10px; }
/* --- LOGIN SCREEN ESTYLES --- */
#login-screen {
justify-content: center;
gap: 25px;
}
.login-title {
font-size: 2.0rem;
font-weight: 900;
text-align: center;
color: #3E2723;
text-shadow: 1px 1px 0px #fff;
margin-bottom: 10px;
}
.login-container {
background: rgba(255,255,255,0.85);
border-radius: 15px;
padding: 25px;
box-shadow: 0 8px 20px rgba(0,0,0,0.3);
border: 2px solid #654321;
}
.login-field {
margin-bottom: 20px;
}
.login-field label {
display: block;
margin-bottom: 8px;
font-weight: bold;
color: #3E2723;
font-size: 1.1rem;
}
.login-error {
color: #ff4757;
font-weight: bold;
margin-top: 15px;
font-size: 1.05rem;
text-align: center;
display: none;
}
/* --- ESTILO CORONA --- */
.leader-crown {
position: absolute;
top: -28px;
left: 50%;
transform: translateX(-50%);
font-size: 1.8rem;
text-shadow: 0 0 8px gold, 0 0 12px gold;
animation: pulse 1.5s infinite;
z-index: 10;
}
@keyframes pulse {
0%, 100% { transform: translateX(-50%) scale(1); }
50% { transform: translateX(-50%) scale(1.1); }
}

/* --- MEDIA QUERIES PARA RESPONSIVE DESIGN --- */
@media (max-width: 768px) {
body {
font-size: 0.9rem;
}
.home-title {
font-size: 1.8rem;
}
button {
padding: 12px;
font-size: 1.0rem;
}
.player-row {
flex-direction: column;
}
.player-row input, .player-row .color-btn {
width: 100%;
}
.cell {
padding: 3px;
font-size: 0.95rem;
min-width: 60px;
min-height: 40px;
}
.turn-label {
font-size: 1.4rem;
margin-bottom: 12px;
}
.leader-crown {
font-size: 1.5rem;
top: -25px;
}
}

@media (max-width: 480px) {
body {
font-size: 0.85rem;
}
.home-title {
font-size: 1.6rem;
}
button {
padding: 10px;
font-size: 0.9rem;
}
.login-title, #lbl-lang-title {
font-size: 1.7rem;
}
.cell {
font-size: 0.85rem;
min-width: 50px;
min-height: 35px;
padding: 2px;
}
.turn-label {
font-size: 1.2rem;
}
.header-col {
font-size: 0.8rem;
}
.leader-crown {
font-size: 1.3rem;
top: -22px;
}
}

@media (min-width: 1200px) {
.home-title {
font-size: 2.6rem;
}
button {
padding: 20px;
font-size: 1.4rem;
}
.cell {
font-size: 1.3rem;
min-width: 80px;
min-height: 55px;
}
.turn-label {
font-size: 1.8rem;
}
}

/* --- ANIMACI√ìN VICTORIA --- */
#winner-overlay {
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background: radial-gradient(circle, #000033, #000066, #000099);
z-index: 3000;
display: flex;
flex-direction: column;
justify-content: center;
align-items: center;
color: white;
text-align: center;
font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
overflow: hidden;
}
.winner-title {
font-size: 4rem;
font-weight: 900;
color: gold;
text-shadow: 
0 0 10px rgba(255,215,0,0.9),
0 0 20px rgba(255,215,0,0.8),
0 0 30px rgba(255,215,0,0.7);
margin-bottom: 30px;
animation: shine 3s infinite linear;
background: linear-gradient(to right, #ffd700, #ffa500, #ffd700);
background-size: 200% auto;
-webkit-background-clip: text;
-webkit-text-fill-color: transparent;
}
@keyframes shine {
0% { background-position: 0% 50%; }
100% { background-position: 200% 50%; }
}
.particles-container {
position: absolute;
top: 0;
left: 0;
width: 100%;
height: 100%;
pointer-events: none;
}
.winner-message {
font-size: 2.5rem;
color: white;
margin-bottom: 40px;
text-shadow: 0 0 15px rgba(255,255,255,0.8);
}
.close-btn {
padding: 15px 40px;
font-size: 1.4rem;
background: linear-gradient(to bottom, gold, #daa520);
color: #3E23;
border: none;
border-radius: 50px;
cursor: pointer;
box-shadow: 
0 0 15px rgba(255,215,0,0.8),
0 0 30px rgba(255,215,0,0.6),
0 0 45px rgba(255,215,0,0.4);
transition: all 0.3s ease;
margin-top: 20px;
font-weight: bold;
text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
}
.close-btn:hover {
transform: scale(1.05);
box-shadow: 
0 0 20px rgba(255,215,0,0.9),
0 0 40px rgba(255,215,0,0.8),
0 0 60px rgba(255,215,0,0.6);
}
.close-btn:active {
transform: scale(0.98);
}
@keyframes float {
0%, 100% { transform: translateY(0); }
50% { transform: translateY(-15px); }
}
@keyframes sparkle {
0% { opacity: 0; transform: scale(0) rotate(0deg); }
20% { opacity: 1; }
100% { opacity: 0; transform: scale(1.5) rotate(180deg); }
}
/* Animaci√≥n para el bot√≥n de cerrar */
@keyframes gradientBG {
0% { background-position: 0% 50%; }
50% { background-position: 100% 50%; }
100% { background-position: 0% 50%; }
}
.close-btn {
background-size: 200% 200%;
animation: gradientBG 3s ease infinite;
}
</style>
</head>
<body>
<div id="login-screen" class="screen active">
<div class="login-title">üîí Acceso Restringido</div>
<div class="login-container">
<div class="login-field">
<label for="password-input">Contrase√±a:</label>
<input type="password" id="password-input" placeholder="Ingresa la contrase√±a">
</div>
<div class="login-field">
<label for="email-input">Correo Electr√≥nico:</label>
<input type="email" id="email-input" placeholder="tuemail@example.com">
</div>
<button id="login-btn" onclick="validateLogin()">Acceder al Juego</button>
<div id="login-error" class="login-error">Contrase√±a o correo incorrecto</div>
</div>
</div>
<div id="home-screen" class="screen">
<div class="home-title" id="lbl-home-welcome">BIENVENIDOS AL ANOTADOR DE GENERALA</div>
<div class="spacer"></div>
<button id="btn-home-start" onclick="navTo('menu')" style="font-size: 1.5rem; padding: 25px;">COMENZAR</button>
<button id="btn-home-lang" onclick="navTo('language')">SELECCIONAR IDIOMA</button>
<div class="spacer"></div>
</div>
<div id="language-screen" class="screen">
<div class="home-title" id="lbl-lang-title" style="margin-bottom: 20px; font-size: 1.8rem;">Elegir Idioma</div>
<div class="grid-lang" id="lang-grid-container" style="flex:1; overflow-y:auto; padding: 5px;">
</div>
<button id="btn-lang-back" onclick="navTo('home')" style="margin-top: 20px;">Volver al Men√∫</button>
</div>
<div id="menu-screen" class="screen">
<div style="flex-direction:row; justify-content: space-between; align-items: center; height: 60px;">
<span id="lbl-menu-welcome" style="font-size:1.4rem; font-weight:900; color: #3E2723;">Bienvenido</span>
</div>
<div id="players-container" style="flex: 1; overflow-y: auto; padding: 10px 0;">
</div>
<div class="v-box">
<div class="h-box">
<button onclick="addPlayerWidget()" style="flex:1; font-size:1.8rem;">+</button>
<button onclick="removePlayerWidget()" style="flex:1; font-size:1.8rem;">-</button>
</div>
<button id="btn-new-game" onclick="startGame()">Nueva Partida</button>
<button id="btn-load-game" onclick="loadGame()">Cargar Partida</button>
<button id="btn-menu-back" onclick="navTo('home')">Volver al Men√∫</button>
</div>
</div>
<div id="anotador-screen" class="screen">
<div id="turn-label" class="turn-label">Turno de:</div>
<div id="score-grid">
</div>
<button id="btn-anotador-back" onclick="navTo('menu')" style="margin-top:15px;">Volver al Men√∫</button>
</div>
<div id="modal-generic" class="modal-overlay">
<div class="modal-content">
<h3 id="modal-title" style="font-size: 1.5rem; margin:0; color:#3E23;">Titulo</h3>
<div id="modal-body" style="font-size: 1.2rem;">Cuerpo</div>
<div class="h-box" id="modal-buttons" style="justify-content: center; margin-top:10px;">
<button onclick="closeModal()">OK</button>
</div>
</div>
</div>
<script>
// ----------------- SONIDO MEJORADO (Web Audio API) -----------------
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
function playSound() {
// Sonido "Pop" adictivo y notorio
if (audioCtx.state === 'suspended') audioCtx.resume();
const t = audioCtx.currentTime;
const oscillator = audioCtx.createOscillator();
const gainNode = audioCtx.createGain();
oscillator.connect(gainNode);
gainNode.connect(audioCtx.destination);
// Tipo de onda: Sine (suave) pero con una ca√≠da r√°pida de frecuencia para el "golpe"
oscillator.type = 'sine';
// Frecuencia: Empieza alto (800Hz) y cae a bajo (150Hz) muy r√°pido
oscillator.frequency.setValueAtTime(800, t);
oscillator.frequency.exponentialRampToValueAtTime(150, t + 0.1);
// Volumen: Ataque instant√°neo y decaimiento exponencial sin "click" al final
gainNode.gain.setValueAtTime(0, t);
gainNode.gain.linearRampToValueAtTime(0.8, t + 0.01); // Volumen m√°s alto
gainNode.gain.exponentialRampToValueAtTime(0.01, t + 0.15);
oscillator.start(t);
oscillator.stop(t + 0.16);
}
// Agregar sonido a todos los botones del documento
document.addEventListener('click', function(e) {
// Si es un bot√≥n o est√° dentro de un bot√≥n
if(e.target.tagName === 'BUTTON' || e.target.closest('button')) {
playSound();
}
});
// ----------------- SISTEMA DE SEGURIDAD -----------------
const AUTHORIZED_EMAILS = [
"franciscojcanestro@gmail.com",
"javier.canestro@gmail.com",
"ineslogioco@gmail.com",
"juanacanestro@gmail.com",
"camilacanestro@gmail.com",
"benitocanestro@gmail.com",
"mateocanestro@gmail.com",
"pedrojcanestro@gmail.com"
];
const ACCESS_PASSWORD = "4444";
function validateLogin() {
const passwordInput = document.getElementById('password-input').value.trim();
const emailInput = document.getElementById('email-input').value.trim().toLowerCase();
const errorElement = document.getElementById('login-error');
// Verificar autenticaci√≥n
if (passwordInput === ACCESS_PASSWORD && AUTHORIZED_EMAILS.includes(emailInput)) {
// Guardar en localStorage que este usuario est√° autorizado
localStorage.setItem('generala_authenticated', JSON.stringify({
email: emailInput,
timestamp: new Date().toISOString()
}));
// Ir a la pantalla de inicio
navTo('home');
} else {
// Mostrar error
errorElement.style.display = 'block';
setTimeout(() => {
errorElement.style.display = 'none';
}, 3000);
}
}
// Verificar si el usuario ya est√° autenticado al cargar la p√°gina
function checkAuthentication() {
const authData = localStorage.getItem('generala_authenticated');
if (authData) {
try {
const parsedData = JSON.parse(authData);
// Verificar que el correo a√∫n est√© autorizado
if (AUTHORIZED_EMAILS.includes(parsedData.email.toLowerCase())) {
// Ya est√° autenticado, ir directamente a home
navTo('home');
return;
}
} catch (e) {
console.error("Error parsing auth data", e);
}
}
// Si no est√° autenticado, mostrar pantalla de login
navTo('login');
}
// ----------------- SEGURIDAD ADICIONAL -----------------
function sanitizeInput(input) {
const div = document.createElement('div');
div.textContent = input;
return div.innerHTML;
}
function saveGameSecure() {
const data = {
names: app.jugadores,
scores: app.puntajes
};
// Encriptaci√≥n b√°sica (para mejor seguridad, usar librer√≠a como CryptoJS)
const encrypted = btoa(JSON.stringify(data));
localStorage.setItem('generala_secure_data', encrypted);
}
function loadGameSecure() {
const encrypted = localStorage.getItem('generala_secure_data');
if (encrypted) {
try {
const decrypted = JSON.parse(atob(encrypted));
app.jugadores = decrypted.names || [];
app.puntajes = decrypted.scores || {};
return true;
} catch (e) {
console.error("Error decrypting ", e);
return false;
}
}
return false;
}
// ----------------- DATOS Y CONFIGURACI√ìN -----------------
const color_names = {
"es": {"red": "Rojo", "blue": "Azul", "green": "Verde", "orange": "Naranja", "purple": "P√∫rpura", "brown": "Marr√≥n", "magenta": "Magenta", "cyan": "Cian", "yellow": "Amarillo", "deeppink": "Rosa", "gold": "Dorado", "turquoise": "Turquesa", "silver": "Plateado", "black": "Negro"},
"en": {"red": "Red", "blue": "Blue", "green": "Green", "orange": "Orange", "purple": "Purple", "brown": "Brown", "magenta": "Magenta", "cyan": "Cyan", "yellow": "Yellow", "deeppink": "Deep Pink", "gold": "Gold", "turquoise": "Turquoise", "silver": "Silver", "black": "Black"},
"pt": {"red": "Vermelho", "blue": "Azul", "green": "Verde", "orange": "Laranja", "purple": "Roxo", "brown": "Marrom", "magenta": "Magenta", "cyan": "Ciano", "yellow": "Amarelo", "deeppink": "Rosa", "gold": "Dourado", "turquoise": "Turquesa", "silver": "Prata", "black": "Preto"},
"fr": {"red": "Rouge", "blue": "Bleu", "green": "Vert", "orange": "Orange", "purple": "Violet", "brown": "Marron", "magenta": "Magenta", "cyan": "Cyan", "yellow": "Jaune", "deeppink": "Rose Fonc√©", "gold": "Or", "turquoise": "Turquoise", "silver": "Argent", "black": "Noir"},
"id": {"red": "Merah", "blue": "Biru", "green": "Hijau", "orange": "Oranye", "purple": "Ungu", "brown": "Coklat", "magenta": "Magenta", "cyan": "Sian", "yellow": "Kuning", "deeppink": "Merah Muda", "gold": "Emas", "turquoise": "Turkis", "silver": "Perak", "black": "Hitam"},
"de": {"red": "Rot", "blue": "Blau", "green": "Gr√ºn", "orange": "Orange", "purple": "Lila", "brown": "Braun", "magenta": "Magenta", "cyan": "Cyan", "yellow": "Gelb", "deeppink": "Dunkelpink", "gold": "Gold", "turquoise": "T√ºrkis", "silver": "Silber", "black": "Schwarz"},
"tr": {"red": "Kƒ±rmƒ±zƒ±", "blue": "Mavi", "green": "Ye≈üil", "orange": "Turuncu", "purple": "Mor", "brown": "Kahverengi", "magenta": "Macenta", "cyan": "Cam mavisi", "yellow": "Sarƒ±", "deeppink": "Derin Pembe", "gold": "Altƒ±n", "turquoise": "Turkuaz", "silver": "G√ºm√º≈ü", "black": "Siyah"},
"it": {"red": "Rosso", "blue": "Blu", "green": "Verde", "orange": "Arancione", "purple": "Viola", "brown": "Marrone", "magenta": "Magenta", "cyan": "Ciano", "yellow": "Giallo", "deeppink": "Rosa Intenso", "gold": "Oro", "turquoise": "Turchese", "silver": "Argento", "black": "Nero"},
"pl": {"red": "Czerwony", "blue": "Niebieski", "green": "Zielony", "orange": "Pomara≈Ñczowy", "purple": "Fioletowy", "brown": "BrƒÖzowy", "magenta": "Magenta", "cyan": "Cyjan", "yellow": "≈ª√≥≈Çty", "deeppink": "Jasnor√≥≈ºowy", "gold": "Z≈Çoty", "turquoise": "Turkusowy", "silver": "Srebrny", "black": "Czarny"},
"vi": {"red": "ƒê·ªè", "blue": "Xanh d∆∞∆°ng", "green": "Xanh l√°", "orange": "Cam", "purple": "T√≠m", "brown": "N√¢u", "magenta": "Magenta", "cyan": "Xanh l∆°", "yellow": "V√†ng", "deeppink": "H·ªìng ƒë·∫≠m", "gold": "V√†ng √≥ng", "turquoise": "Xanh ng·ªçc", "silver": "B·∫°c", "black": "ƒêen"},
"nl": {"red": "Rood", "blue": "Blauw", "green": "Groen", "orange": "Oranje", "purple": "Paars", "brown": "Bruin", "magenta": "Magenta", "cyan": "Cyaan", "yellow": "Geel", "deeppink": "Diep Roze", "gold": "Goud", "turquoise": "Turkoois", "silver": "Zilver", "black": "Zwart"},
"ro": {"red": "Ro»ôu", "blue": "Albastru", "green": "Verde", "orange": "Portocaliu", "purple": "Mov", "brown": "Maro", "magenta": "Magenta", "cyan": "Cian", "yellow": "Galben", "deeppink": "Roz intens", "gold": "Auriu", "turquoise": "Turcoaz", "silver": "Argintiu", "black": "Negru"},
"zh": {"red": "Á∫¢Ëâ≤", "blue": "ËìùËâ≤", "green": "ÁªøËâ≤", "orange": "Ê©ôËâ≤", "purple": "Á¥´Ëâ≤", "brown": "Ê£ïËâ≤", "magenta": "Ê¥ãÁ∫¢Ëâ≤", "cyan": "ÈùíËâ≤", "yellow": "ÈªÑËâ≤", "deeppink": "Ê∑±Á≤âËâ≤", "gold": "ÈáëËâ≤", "turquoise": "ÁªøÊùæÁü≥Ëâ≤", "silver": "Èì∂Ëâ≤", "black": "ÈªëËâ≤"}
};
const translations = {
"es": {"home_welcome": "BIENVENIDOS AL ANOTADOR DE GENERALA", "home_title": "COMENZAR", "home_lang": "SELECCIONAR IDIOMA", "welcome": "Bienvenidos al Anotador de Generala", "player_name_hint": "Nombre del jugador", "new_game": "Nueva Partida", "load_game": "Cargar Partida", "back_to_menu": "Volver al Men√∫", "turn_of": "Turno de:", "select_color": "Seleccionar Color", "select_score": "Seleccionar Puntaje", "error": "Error", "choose_language": "Elegir Idioma", "confirm": "Confirmar", "confirm_turn": "¬øSeguro que quieres anotar en {target} siendo turno de {current}?", "yes": "S√≠", "no": "No", "max_players": "M√°ximo 10 jugadores.", "min_players": "M√≠nimo 2 jugadores.", "no_saved_game": "No hay partida guardada.", "category_header": "Categor√≠a", "scratch": "Tachar", "end_game": "Fin del Juego", "winner_msg": "ha ganado!!"},
"en": {"home_welcome": "WELCOME TO THE GENERALA SCOREKEEPER", "home_title": "START", "home_lang": "SELECT LANGUAGE", "welcome": "Welcome to the Generala Scorekeeper", "player_name_hint": "Player Name", "new_game": "New Game", "load_game": "Load Game", "back_to_menu": "Back to Menu", "turn_of": "Turn of:", "select_color": "Select Color", "select_score": "Select Score", "error": "Error", "choose_language": "Choose Language", "confirm": "Confirm", "confirm_turn": "Are you sure you want to score on {target} while it is {current}'s turn?", "yes": "Yes", "no": "No", "max_players": "Maximum 10 players.", "min_players": "Minimum 2 players.", "no_saved_game": "No saved game found.", "category_header": "Category", "scratch": "Scratch", "end_game": "End of the Game", "winner_msg": "has won!!"},
"pt": {"home_welcome": "BEM-VINDO AO CONTADOR DE GENERALA", "home_title": "COME√áAR", "home_lang": "SELECCIONAR IDIOMA", "welcome": "Bem-vindo ao Marcador de Generala", "player_name_hint": "Nome do jogador", "new_game": "Novo Jogo", "load_game": "Carregar Jogo", "back_to_menu": "Voltar ao Menu", "turn_of": "Vez de:", "select_color": "Selecionar Cor", "select_score": "Selecionar Pontua√ß√£o", "error": "Erro", "choose_language": "Escolher Idioma", "confirm": "Confirmar", "confirm_turn": "Tem certeza de que deseja anotar em {target} enquanto √© a vez de {current}?", "yes": "Sim", "no": "N√£o", "max_players": "M√°ximo de 10 jogadores.", "min_players": "M√≠nimo de 2 jogadores.", "no_saved_game": "Nenhum jogo salvo.", "category_header": "Categoria", "scratch": "Tachar", "end_game": "Fim do Jogo", "winner_msg": "venceu!!"},
"fr": {"home_welcome": "BIENVENUE DANS LE COMPTEUR DE GENERALA", "home_title": "COMMENCER", "home_lang": "CHOISIR LA LANGUE", "welcome": "Bienvenue sur le compteur de Generala", "player_name_hint": "Nom du joueur", "new_game": "Nouvelle Partie", "load_game": "Charger la Partie", "back_to_menu": "Retour au Menu", "turn_of": "√Ä vous de jouer:", "select_color": "Choisir la Couleur", "select_score": "Choisir le Score", "error": "Erreur", "choose_language": "Choisir la Langue", "confirm": "Confirmer", "confirm_turn": "√ätes-vous s√ªr de vouloir enregistrer le score sur {target} alors que c'est le tour de {current} ?", "yes": "Oui", "no": "Non", "max_players": "Maximum 10 joueurs.", "min_players": "Minimum 2 joueurs.", "no_saved_game": "Aucune partie sauvegard√©e.", "category_header": "Cat√©gorie", "scratch": "Effacer", "end_game": "Fin du Jeu", "winner_msg": "a gagn√©!!"},
"id": {"home_welcome": "SELAMAT DATANG DI PENCATAT GENERALA", "home_title": "MULAI", "home_lang": "PILIH BAHASA", "welcome": "Selamat datang di Pembukuan Generala", "player_name_hint": "Nama Pemain", "new_game": "Permainan Baru", "load_game": "Muat Permainan", "back_to_menu": "Kembali ke Menu", "turn_of": "Giliran:", "select_color": "Pilih Warna", "select_score": "Pilih Skor", "error": "Kesalahan", "choose_language": "Pilih Bahasa", "confirm": "Konfirmasi", "confirm_turn": "Apakah Anda yakin ingin mencatat skor di {target} sementara giliran {current}?", "yes": "Ya", "no": "Tidak", "max_players": "Maksimal 10 pemain.", "min_players": "Minimal 2 pemain.", "no_saved_game": "Tidak ada permainan tersimpan.", "category_header": "Kategori", "scratch": "Hapus", "end_game": "Permainan Selesai", "winner_msg": "menang!!"},
"de": {"home_welcome": "WILLKOMMEN BEIM GENERALA-SCOREKEEPER", "home_title": "STARTEN", "home_lang": "SPRACHE W√ÑHLEN", "welcome": "Willkommen beim Generala-Punkteverwalter", "player_name_hint": "Spielername", "new_game": "Neues Spiel", "load_game": "Spiel Laden", "back_to_menu": "Zur√ºck zum Men√º", "turn_of": "Am Zug:", "select_color": "Farbe ausw√§hlen", "select_score": "Punktzahl ausw√§hlen", "error": "Fehler", "choose_language": "Sprache w√§hlen", "confirm": "Best√§tigen", "confirm_turn": "Bist du sicher, dass du bei {target} Punkte notieren m√∂chtest, w√§hrend {current} am Zug ist?", "yes": "Ja", "no": "Nein", "max_players": "Maximum 10 Spieler.", "min_players": "Minimum 2 Spieler.", "no_saved_game": "Kein gespeichertes Spiel gefunden.", "category_header": "Kategorie", "scratch": "L√∂schen", "end_game": "Spiel Ende", "winner_msg": "hat gewonnen!!"},
"tr": {"home_welcome": "GENERALA PUAN TABLOSUNA HO≈û GELDƒ∞Nƒ∞Z", "home_title": "BA≈ûLA", "home_lang": "Dƒ∞Lƒ∞ SE√á", "welcome": "Generala Puan Tablosuna Ho≈ügeldiniz", "player_name_hint": "Oyuncu Adƒ±", "new_game": "Yeni Oyun", "load_game": "Oyunu Y√ºkle", "back_to_menu": "Men√ºye D√∂n", "turn_of": "Sƒ±ra:", "select_color": "Renk Se√ß", "select_score": "Puan Se√ß", "error": "Hata", "choose_language": "Dil Se√ß", "confirm": "Onayla", "confirm_turn": "{target} i√ßin puan eklemek istediƒüinizden emin misiniz? Sƒ±ra {current}.", "yes": "Evet", "no": "Hayƒ±r", "max_players": "Maksimum 10 oyuncu.", "min_players": "Minimum 2 oyuncu.", "no_saved_game": "Kayƒ±tlƒ± oyun bulunamadƒ±.", "category_header": "Kategori", "scratch": "Sil", "end_game": "Oyunun Sonu", "winner_msg": "kazandƒ±!!"},
"it": {"home_welcome": "BENVENUTI AL REGISTRATORE DI GENERALA", "home_title": "INIZIA", "home_lang": "SELEZIONA LINGUA", "welcome": "Benvenuti al Segnapunti di Generala", "player_name_hint": "Nome del giocatore", "new_game": "Nuova Partita", "load_game": "Carica Partita", "back_to_menu": "Torna al Men√π", "turn_of": "Tocca a:", "select_color": "Seleziona Colore", "select_score": "Seleziona Punteggio", "error": "Errore", "choose_language": "Scegli Lingua", "confirm": "Conferma", "confirm_turn": "Sei sicuro di voler annotare il punteggio per {target} mentre tocca a {current}?", "yes": "S√¨", "no": "No", "max_players": "Massimo 10 giocatori.", "min_players": "Minimo 2 giocatori.", "no_saved_game": "Nessuna partita salvata.", "category_header": "Categoria", "scratch": "Cancella", "end_game": "Fine del Gioco", "winner_msg": "ha vinto!!"},
"pl": {"home_welcome": "WITAMY W GENERALA SCOREKEEPER", "home_title": "START", "home_lang": "WYBIERZ JƒòZYK", "welcome": "Witamy w notatniku do Generala", "player_name_hint": "Imiƒô gracza", "new_game": "Nowa Gra", "load_game": "Wczytaj Grƒô", "back_to_menu": "Powr√≥t do Menu", "turn_of": "Ruch:", "select_color": "Wybierz kolor", "select_score": "Wybierz wynik", "error": "B≈ÇƒÖd", "choose_language": "Wybierz jƒôzyk", "confirm": "Potwierd≈∫", "confirm_turn": "Czy na pewno chcesz zanotowaƒá wynik dla {target}, podczas gdy kolej {current}?", "yes": "Tak", "no": "Nie", "max_players": "Maksymalnie 10 graczy.", "min_players": "Minimalnie 2 graczy.", "no_saved_game": "Nie znaleziono zapisanej gry.", "category_header": "Kategoria", "scratch": "Skre≈õl", "end_game": "Koniec Gry", "winner_msg": "wygra≈Ç!!"},
"vi": {"home_welcome": "CH√ÄO M·ª™NG ƒê·∫æN V·ªöI B·∫¢NG ƒêI·ªÇM GENERALA", "home_title": "B·∫ÆT ƒê·∫¶U", "home_lang": "CH·ªåN NG√îN NG·ªÆ", "welcome": "Ch√†o m·ª´ng ƒë·∫øn v·ªõi B·∫£ng Ghi ƒêi·ªÉm Generala", "player_name_hint": "T√™n ng∆∞·ªùi ch∆°i", "new_game": "Tr√≤ ch∆°i M·ªõi", "load_game": "T·∫£i Tr√≤ Ch∆°i", "back_to_menu": "Quay l·∫°i Menu", "turn_of": "L∆∞·ª£t c·ªßa:", "select_color": "Ch·ªçn M√†u", "select_score": "Ch·ªçn ƒêi·ªÉm s·ªë", "error": "L·ªói", "choose_language": "Ch·ªçn Ng√¥n ng·ªØ", "confirm": "X√°c nh·∫≠n", "confirm_turn": "B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën ghi ƒëi·ªÉm cho {target} trong khi ƒë·∫øn l∆∞·ª£t {current} kh√¥ng?", "yes": "V√¢ng", "no": "Kh√¥ng", "max_players": "T·ªëi ƒëa 10 ng∆∞·ªùi ch∆°i.", "min_players": "T·ªëi thi·ªÉu 2 ng∆∞·ªùi ch∆°i.", "no_saved_game": "Kh√¥ng c√≥ tr√≤ ch∆°i ƒë∆∞·ª£c l∆∞u.", "category_header": "Lo·∫°i", "scratch": "Xo√°", "end_game": "K·∫øt th√∫c tr√≤ ch∆°i", "winner_msg": "ƒë√£ th·∫Øng!!"},
"nl": {"home_welcome": "WELKOM BIJ DE GENERALA SCOREKEEPER", "home_title": "START", "home_lang": "TAAL SELECTEREN", "welcome": "Welkom bij de Generala Scorekeeper", "player_name_hint": "Spelersnaam", "new_game": "Nieuw Spel", "load_game": "Spel Laden", "back_to_menu": "Terug naar Menu", "turn_of": "Beurt van:", "select_color": "Selecteer Kleur", "select_score": "Selecteer Score", "error": "Fout", "choose_language": "Kies Taal", "confirm": "Bevestigen", "confirm_turn": "Weet je zeker dat je punten wilt noteren voor {target} terwijl het de beurt is van {current}?", "yes": "Ja", "no": "Nee", "max_players": "Maximaal 10 spelers.", "min_players": "Minimaal 2 spelers.", "no_saved_game": "Geen opgeslagen spel gevonden.", "category_header": "Categorie", "scratch": "Doorstrepen", "end_game": "Einde van het Spel", "winner_msg": "heeft gewonnen!!"},
"ro": {"home_welcome": "BINE A»öI VENIT LA TABELUL DE SCOR GENERALA", "home_title": "PORNE»òTE", "home_lang": "SELECTEAZƒÇ LIMBA", "welcome": "Bine a»õi venit la Tabelul de Scor Generala", "player_name_hint": "Numele jucƒÉtorului", "new_game": "Joc Nou", "load_game": "√éncarcƒÉ Joc", "back_to_menu": "√énapoi la Meniu", "turn_of": "R√¢ndul lui:", "select_color": "SelecteazƒÉ Culoare", "select_score": "SelecteazƒÉ Scor", "error": "Eroare", "choose_language": "Alege Limba", "confirm": "ConfirmƒÉ", "confirm_turn": "E»ôti sigur cƒÉ vrei sƒÉ notezi scorul la {target} √Æn timp ce este r√¢ndul lui {current}?", "yes": "Da", "no": "Nu", "max_players": "Maximum 10 jucƒÉtori.", "min_players": "Minimum 2 jucƒÉtori.", "no_saved_game": "Niciun joc salvat gƒÉsit.", "category_header": "Categorie", "scratch": "AnuleazƒÉ", "end_game": "Sf√¢r»ôitul Jocului", "winner_msg": "a c√¢»ôtigat!!"},
"zh": {"home_welcome": "Ê¨¢Ëøé‰ΩøÁî®GENERALAËÆ∞ÂàÜÂëò", "home_title": "ÂºÄÂßã", "home_lang": "ÈÄâÊã©ËØ≠Ë®Ä", "welcome": "Ê¨¢Ëøé‰ΩøÁî®GeneralaËÆ∞ÂàÜÂëò", "player_name_hint": "Áé©ÂÆ∂ÂêçÁß∞", "new_game": "Êñ∞Ê∏∏Êàè", "load_game": "Âä†ËΩΩÊ∏∏Êàè", "back_to_menu": "ËøîÂõûËèúÂçï", "turn_of": "ËΩÆÂà∞Ôºö", "select_color": "ÈÄâÊã©È¢úËâ≤", "select_score": "ÈÄâÊã©ÂàÜÊï∞", "error": "ÈîôËØØ", "choose_language": "ÈÄâÊã©ËØ≠Ë®Ä", "confirm": "Á°ÆËÆ§", "confirm_turn": "ÊÇ®Á°ÆÂÆöË¶Å‰∏∫{target}ËÆ∞ÂàÜÔºåËÄåËΩÆÂà∞{current}Ôºü", "yes": "ÊòØ", "no": "Âê¶", "max_players": "ÊúÄÂ§ö10ÂêçÁé©ÂÆ∂„ÄÇ", "min_players": "ÊúÄÂ∞ë2ÂêçÁé©ÂÆ∂„ÄÇ", "no_saved_game": "Êú™ÊâæÂà∞Â∑≤‰øùÂ≠òÁöÑÊ∏∏Êàè„ÄÇ", "category_header": "Á±ªÂà´", "scratch": "ÂàíÊéâ", "end_game": "Ê∏∏ÊàèÁªìÊùü", "winner_msg": "Ëé∑ËÉúÔºÅÔºÅ"}
};
const categories_translations = {
"es": ["1", "2", "3", "4", "5", "6", "esc.", "full.", "pok.", "gen", "gen2"],
"en": ["1", "2", "3", "4", "5", "6", "str.", "full.", "pok.", "gen", "gen2"],
"pt": ["1", "2", "3", "4", "5", "6", "esc.", "full.", "pok.", "gen", "gen2"],
"fr": ["1", "2", "3", "4", "5", "6", "suit.", "full.", "pok.", "gen", "gen2"],
"id": ["1", "2", "3", "4", "5", "6", "tang.", "full.", "pok.", "gen", "gen2"],
"de": ["1", "2", "3", "4", "5", "6", "str.", "full.", "pok.", "gen", "gen2"],
"tr": ["1", "2", "3", "4", "5", "6", "d√ºz.", "full.", "pok.", "gen", "gen2"],
"it": ["1", "2", "3", "4", "5", "6", "scal.", "full.", "pok.", "gen", "gen2"],
"pl": ["1", "2", "3", "4", "5", "6", "strit.", "full.", "pok.", "gen", "gen2"],
"vi": ["1", "2", "3", "4", "5", "6", "d√£y", "full.", "pok.", "gen", "gen2"],
"nl": ["1", "2", "3", "4", "5", "6", "straat.", "full.", "pok.", "gen", "gen2"],
"ro": ["1", "2", "3", "4", "5", "6", "scarƒÉ", "full.", "pok.", "gen", "gen2"],
"zh": ["1", "2", "3", "4", "5", "6", "È°∫.", "Êª°.", "Âõõ.", "Â∞Ü.", "Â∞Ü2"]
};
const score_options = {
"0": [0,1,2,3,4,5], "1": [0,2,4,6,8,10], "2": [0,3,6,9,12,15],
"3": [0,4,8,12,16,20], "4": [0,5,10,15,20,25], "5": [0,6,12,18,24,30],
"6": [0,20,25], "7": [0,30,35], "8": [0,40,45], "9": [0,50], "10": [0,100]
};
const max_points_map = [5, 10, 15, 20, 25, 30, 25, 35, 45, 50, 100];
const hex_colors = {
"white": "#FFFFFF", "black": "#000000", "red": "#FF0000", "blue": "#0000FF",
"green": "#00FF00", "orange": "#FFA500", "purple": "#800080", "brown": "#8B4513",
"magenta": "#FF00FF", "cyan": "#00FFFF", "yellow": "#FFFF00", "deeppink": "#FF1493",
"gold": "#FFD700", "turquoise": "#40E0D0", "silver": "#C0C0C0"
};
// ----------------- ESTADO GLOBAL -----------------
let app = {
lang: "es",
jugadores: ["", ""],
jugador_colores: ["red", "blue"],
puntajes: {},
current_turn: 0,
dead_players: new Set(),
victoria_mostrada: false,
leader_idx: -1
};
// ----------------- UTILIDADES -----------------
function getText(key) {
return (translations[app.lang] || translations["es"])[key] || key;
}
function getCategories() {
return categories_translations[app.lang] || categories_translations["es"];
}
function abreviarNombre(nombre, num_players) {
if (!nombre) return "";
if (!isNaN(nombre)) return nombre;
// Limitar a 9 caracteres m√°ximo
if (nombre.length > 9) {
return nombre.substring(0, 9);
}
if (nombre.startsWith("Jugador ")) {
let parts = nombre.split(" ", 2);
return parts.length > 1 ? "Juga " + parts[1] : nombre;
}
return nombre;
}
function getHexColor(name) {
return hex_colors[name] || name;
}
// Funci√≥n estricta de color de texto: BLANCO SOLO SI EL FONDO ES NEGRO
function getTextColorForBg(bgKey) {
return (bgKey === "black") ? "white" : "black";
}
// ----------------- NAVEGACI√ìN -----------------
function navTo(screenId) {
document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
document.getElementById(screenId + '-screen').classList.add('active');
if (screenId === 'home') updateHomeText();
if (screenId === 'menu') updateMenuText();
if (screenId === 'language') initLangScreen();
if (screenId === 'anotador') updateAnotadorText();
}
// ----------------- HOME LOGIC -----------------
function updateHomeText() {
document.getElementById('lbl-home-welcome').innerText = getText('home_welcome');
document.getElementById('btn-home-start').innerText = getText('home_title');
document.getElementById('btn-home-lang').innerText = getText('home_lang');
}
// ----------------- LANGUAGE LOGIC -----------------
function initLangScreen() {
document.getElementById('lbl-lang-title').innerText = getText('choose_language');
document.getElementById('btn-lang-back').innerText = getText('back_to_menu');
const container = document.getElementById('lang-grid-container');
container.innerHTML = "";
const idiomas = [
["es", "Espa√±ol"], ["en", "English"], ["pt", "Portugu√™s"], ["fr", "Fran√ßais"],
["id", "Bahasa Indonesia"], ["de", "Deutsch"], ["tr", "T√ºrk√ße"], ["it", "Italiano"],
["pl", "Polski"], ["vi", "Ti·∫øng Vi·ªát"], ["nl", "Nederlands"], ["ro", "Rom√¢nƒÉ"],
["zh", "‰∏≠Êñá"]
];
idiomas.forEach(([code, name]) => {
let btn = document.createElement('button');
btn.innerText = name;
btn.onclick = () => setLanguage(code);
container.appendChild(btn);
});
}
function setLanguage(code) {
app.lang = code;
app.jugadores = app.jugadores.map(() => "");
app.jugador_colores = app.jugador_colores.slice(0, app.jugadores.length);
resetPlayersUI();
navTo('home');
}
// ----------------- MENU LOGIC -----------------
let playerWidgets = [];
function updateMenuText() {
document.getElementById('lbl-menu-welcome').innerText = getText('welcome');
document.getElementById('btn-new-game').innerText = getText('new_game');
document.getElementById('btn-load-game').innerText = getText('load_game');
document.getElementById('btn-menu-back').innerText = getText('back_to_menu');
document.querySelectorAll('.player-name-input').forEach(i => i.placeholder = getText('player_name_hint'));
playerWidgets.forEach((w, idx) => {
updateColorButton(w.btn, app.jugador_colores[idx]);
});
}
function resetPlayersUI() {
document.getElementById('players-container').innerHTML = "";
playerWidgets = [];
if(app.jugadores.length === 0) {
app.jugadores = ["", ""];
app.jugador_colores = ["red", "blue"];
}
for (let i=0; i<app.jugadores.length; i++) {
createPlayerWidgetRow(i);
}
}
function createPlayerWidgetRow(idx) {
const container = document.getElementById('players-container');
const row = document.createElement('div');
row.className = 'player-row';
const input = document.createElement('input');
input.type = 'text';
input.className = 'player-name-input';
input.placeholder = getText('player_name_hint');
input.value = app.jugadores[idx];
input.oninput = (e) => app.jugadores[idx] = e.target.value;
const btnColor = document.createElement('button');
btnColor.className = 'color-btn';
updateColorButton(btnColor, app.jugador_colores[idx]);
btnColor.onclick = () => openColorSelector(idx, btnColor);
row.appendChild(input);
row.appendChild(btnColor);
container.appendChild(row);
playerWidgets[idx] = { row, input, btn: btnColor };
}
function updateColorButton(btn, colorKey) {
let colorName = (color_names[app.lang] || color_names["es"])[colorKey] || colorKey;
btn.innerText = colorName;
btn.style.background = getHexColor(colorKey); // Override gradient
// LOGICA ESTRICTA: Negro para todos, Blanco solo para fondo Negro
btn.style.color = getTextColorForBg(colorKey);
// Ajustar borde para que se vea bien con el color plano
btn.style.border = "2px solid rgba(0,0,0,0.2)";
}
function addPlayerWidget() {
if (app.jugadores.length >= 10) {
showPopup(getText('error'), getText('max_players'));
return;
}
app.jugadores.push("");
let availableColors = Object.keys(color_names[app.lang] || color_names["es"]);
let newColor = availableColors[app.jugadores.length % availableColors.length];
app.jugador_colores.push(newColor);
createPlayerWidgetRow(app.jugadores.length - 1);
}
function removePlayerWidget() {
if (app.jugadores.length <= 2) {
showPopup(getText('error'), getText('min_players'));
return;
}
let idx = app.jugadores.length - 1;
let w = playerWidgets[idx];
w.row.remove();
playerWidgets.pop();
app.jugadores.pop();
app.jugador_colores.pop();
}
function openColorSelector(playerIdx, btnElement) {
const content = document.createElement('div');
content.className = 'grid-colors';
let colors = color_names[app.lang] || color_names["es"];
Object.keys(colors).forEach(k => {
let b = document.createElement('button');
b.innerText = colors[k];
b.style.background = getHexColor(k);
// LOGICA ESTRICTA TAMBIEN EN POPUP
b.style.color = getTextColorForBg(k);
b.style.border = "1px solid #555";
b.style.fontSize = "0.9rem";
b.onclick = () => {
app.jugador_colores[playerIdx] = k;
updateColorButton(btnElement, k);
closeModal();
};
content.appendChild(b);
});
showCustomModal(getText('select_color'), content);
}
// ----------------- GAME START / LOAD -----------------
function startGame() {
for(let i=0; i<app.jugadores.length; i++) {
let raw = app.jugadores[i].trim();
if (!raw) raw = (i+1).toString();
app.jugadores[i] = abreviarNombre(raw, app.jugadores.length);
}
app.current_turn = 0;
app.puntajes = {};
app.victoria_mostrada = false;
app.dead_players = new Set();
buildTable();
navTo('anotador');
updateTurnLabel();
updateLeaderCrown();
}
function loadGame() {
let saved = localStorage.getItem('generala_secure_data');
if (!saved) {
showPopup(getText('error'), getText('no_saved_game'));
return;
}
if (loadGameSecure()) {
resetPlayersUI();
app.jugadores.forEach((n, i) => {
if(playerWidgets[i]) playerWidgets[i].input.value = n;
});
navTo('anotador');
buildTable();
Object.keys(app.puntajes).forEach(key => {
let cell = document.getElementById('cell-' + key);
if(cell) cell.innerText = app.puntajes[key];
});
updateTotals();
updateLeaderCrown();
checkVictory();
app.current_turn = 0;
updateTurnLabel();
}
}
function saveGame() {
saveGameSecure();
}
// ----------------- ANOTADOR LOGIC -----------------
function updateAnotadorText() {
document.getElementById('btn-anotador-back').innerText = getText('back_to_menu');
updateTurnLabel();
}
function updateTurnLabel() {
if(app.jugadores[app.current_turn]) {
document.getElementById('turn-label').innerText = getText('turn_of') + " " + app.jugadores[app.current_turn];
}
}
function buildTable() {
const grid = document.getElementById('score-grid');
grid.innerHTML = "";
const cats = getCategories();
const catsFull = [...cats, "Total"];
const numPlayers = app.jugadores.length;
grid.style.gridTemplateColumns = `1.4fr repeat(${numPlayers}, 1fr)`;
// Header Corner
let corner = document.createElement('div');
corner.className = 'cell header-col';
corner.innerText = getText('category_header');
grid.appendChild(corner);
// Header Players
app.jugadores.forEach((p, i) => {
let pc = document.createElement('div');
pc.className = 'cell';
pc.innerText = p;
let cKey = app.jugador_colores[i];
pc.style.backgroundColor = getHexColor(cKey);
// LOGICA ESTRICTA EN HEADER
pc.style.color = getTextColorForBg(cKey);
pc.id = 'header-p-' + i;
pc.dataset.originalColor = cKey; // Guardar color original para l√≥gica de eliminados
pc.style.position = 'relative';
grid.appendChild(pc);
});
// Rows
catsFull.forEach((catName, rIdx) => {
// Category Label
let cLabel = document.createElement('div');
cLabel.className = 'cell header-col';
cLabel.innerText = catName;
let rowBgColor = (rIdx % 2 === 0) ? 'var(--color-row1)' : 'var(--color-row2)';
cLabel.style.backgroundColor = rowBgColor;
grid.appendChild(cLabel);
// Player Cells
for(let p=0; p<numPlayers; p++) {
let cellDiv = document.createElement('div');
cellDiv.className = 'cell';
let cKey = app.jugador_colores[p];
let cellBg = getHexColor(cKey);
// LOGICA ESTRICTA EN CELDAS
let cellTxt = getTextColorForBg(cKey);
cellDiv.style.backgroundColor = cellBg;
cellDiv.style.color = cellTxt;
cellDiv.dataset.originalColor = cKey;
if (catName === "Total") {
cellDiv.id = `total-${p}`;
cellDiv.innerText = "0";
} else {
let btn = document.createElement('button');
btn.className = 'cell-btn';
btn.id = `cell-${p}-${rIdx}`;
btn.innerText = "0";
btn.onclick = () => selectScore(p, rIdx.toString());
cellDiv.appendChild(btn);
}
grid.appendChild(cellDiv);
}
});
}
function selectScore(playerIdx, catKey) {
if (playerIdx !== app.current_turn) {
let target = app.jugadores[playerIdx];
let current = app.jugadores[app.current_turn];
let msg = getText('confirm_turn').replace('{target}', target).replace('{current}', current);
showConfirm(msg, () => openScorePopup(playerIdx, catKey));
} else {
openScorePopup(playerIdx, catKey);
}
}
function openScorePopup(playerIdx, catKey) {
let cats = getCategories();
let catName = cats[parseInt(catKey)] || "?";
let title = `${app.jugadores[playerIdx]} - ${catName}`;
let pts = score_options[catKey] || [0,1,2,3];
let scratch = getText('scratch');
let content = document.createElement('div');
content.className = 'grid-scores';
[...pts, "X"].forEach(val => {
let b = document.createElement('button');
b.className = 'score-val-btn';
let displayVal = (val === "X") ? scratch : val;
b.innerText = (val === "X") ? "X" : val;
if (val === "X") b.innerText = "X";
b.onclick = () => confirmScore(playerIdx, catKey, (val === "X" ? "X" : val.toString()));
content.appendChild(b);
});
showCustomModal(getText('select_score') + ": " + title, content);
}
function confirmScore(playerIdx, catKey, val) {
closeModal();
let cellBtn = document.getElementById(`cell-${playerIdx}-${catKey}`);
let prev = cellBtn.innerText;
cellBtn.innerText = val;
app.puntajes[`${playerIdx}-${catKey}`] = val;
updateTotals();
updateLeaderCrown();
saveGame();
checkVictory();
if (playerIdx === app.current_turn && prev === "0" && val !== "0") {
let totalP = app.jugadores.length;
let next = (playerIdx + 1) % totalP;
while (app.dead_players.has(next)) {
next = (next + 1) % totalP;
if (next === playerIdx) break;
}
app.current_turn = next;
updateTurnLabel();
}
}
function updateTotals() {
let numCats = getCategories().length;
for(let j=0; j<app.jugadores.length; j++) {
let total = 0;
for(let i=0; i<numCats; i++) {
let val = app.puntajes[`${j}-${i}`];
if (val && val !== "X") {
total += parseInt(val);
}
}
let totalCell = document.getElementById(`total-${j}`);
if(totalCell) {
totalCell.innerText = total;
app.puntajes[`${j}-${numCats}`] = total.toString();
}
}
}
function updateLeaderCrown() {
// Remover coronas existentes
document.querySelectorAll('.leader-crown').forEach(el => el.remove());
let numCats = getCategories().length;
let highestScore = -1;
let leaders = [];
// Encontrar el puntaje m√°s alto
for(let j=0; j<app.jugadores.length; j++) {
if (app.dead_players.has(j)) continue; // Ignorar jugadores eliminados
let score = parseInt(app.puntajes[`${j}-${numCats}`] || "0");
if (score > highestScore) {
highestScore = score;
leaders = [j];
} else if (score === highestScore && score > 0) {
leaders.push(j);
}
}
// Agregar corona a cada l√≠der (en caso de empate)
leaders.forEach(leaderIdx => {
let header = document.getElementById(`header-p-${leaderIdx}`);
if (header) {
let crown = document.createElement('div');
crown.className = 'leader-crown';
crown.innerHTML = 'üëë';
header.appendChild(crown);
}
});
}
function checkVictory() {
app.dead_players.clear();
let numCats = getCategories().length;
let best = 0;
for(let j=0; j<app.jugadores.length; j++) {
let s = parseInt(app.puntajes[`${j}-${numCats}`] || "0");
if (s > best) best = s;
}
for(let j=0; j<app.jugadores.length; j++) {
let currentScore = parseInt(app.puntajes[`${j}-${numCats}`] || "0");
let maxRemaining = 0;
for(let i=0; i<numCats; i++) {
let val = app.puntajes[`${j}-${i}`];
if (!val || val === "0") {
maxRemaining += max_points_map[i];
}
}
// L√≥gica de eliminaci√≥n
if ((currentScore + maxRemaining) < best) {
app.dead_players.add(j);
applyDeadStyle(j, true);
} else {
applyDeadStyle(j, false);
}
}
let vivos = app.jugadores.map((_, i) => i).filter(i => !app.dead_players.has(i));
if (vivos.length === 1 && !app.victoria_mostrada) {
app.victoria_mostrada = true;
let winnerIdx = vivos[0];
// showPopup(getText('end_game'), `¬°${app.jugadores[winnerIdx]} ${getText('winner_msg')}`);
showWinnerAnimation(winnerIdx);
}
}
function applyDeadStyle(playerIdx, isDead) {
// Determinar tipo de l√≠nea seg√∫n color original
// Si el jugador era NEGRO -> L√≠nea BLANCA
// Si el jugador era cualquier otro -> L√≠nea NEGRA
const originalColor = app.jugador_colores[playerIdx];
const lineClass = (originalColor === 'black') ? 'dead-line-white' : 'dead-line-black';
// Elementos a afectar: Header, Total y Celdas
const elements = [];
elements.push(document.getElementById(`header-p-${playerIdx}`));
elements.push(document.getElementById(`total-${playerIdx}`));
let numCats = getCategories().length;
for(let i=0; i<numCats; i++) {
let btn = document.getElementById(`cell-${playerIdx}-${i}`);
if(btn) elements.push(btn.parentElement);
}
elements.forEach(el => {
if(!el) return;
if(isDead) {
el.classList.add('dead-cell');
el.classList.add(lineClass);
} else {
el.classList.remove('dead-cell');
el.classList.remove('dead-line-black');
el.classList.remove('dead-line-white');
}
// Remover corona si est√° eliminado
if(isDead) {
let crown = el.querySelector('.leader-crown');
if(crown) crown.remove();
}
});
}
// ----------------- POPUP SYSTEM -----------------
function showPopup(title, bodyText) {
document.getElementById('modal-title').innerText = title;
document.getElementById('modal-body').innerHTML = "";
let p = document.createElement('p');
p.innerText = bodyText;
document.getElementById('modal-body').appendChild(p);
let btnBox = document.getElementById('modal-buttons');
btnBox.innerHTML = '<button onclick="closeModal()">OK</button>';
document.getElementById('modal-generic').style.display = 'flex';
}
function showConfirm(text, onYes) {
document.getElementById('modal-title').innerText = getText('confirm');
document.getElementById('modal-body').innerText = text;
let btnBox = document.getElementById('modal-buttons');
btnBox.innerHTML = "";
let bYes = document.createElement('button');
bYes.innerText = getText('yes');
bYes.onclick = () => { closeModal(); onYes(); };
let bNo = document.createElement('button');
bNo.innerText = getText('no');
bNo.onclick = closeModal;
btnBox.appendChild(bYes);
btnBox.appendChild(bNo);
document.getElementById('modal-generic').style.display = 'flex';
}
function showCustomModal(title, contentElement) {
document.getElementById('modal-title').innerText = title;
let body = document.getElementById('modal-body');
body.innerHTML = "";
body.appendChild(contentElement);
document.getElementById('modal-buttons').innerHTML = '<button onclick="closeModal()">Cancelar</button>';
document.getElementById('modal-generic').style.display = 'flex';
}
function closeModal() {
document.getElementById('modal-generic').style.display = 'none';
}
// ----------------- ANIMACI√ìN DE VICTORIA -----------------
function showWinnerAnimation(winnerIdx) {
// Crear overlay brillante
let overlay = document.createElement('div');
overlay.id = 'winner-overlay';
let winnerName = app.jugadores[winnerIdx];
// Texto del ganador
let winnerTitle = document.createElement('h1');
winnerTitle.className = 'winner-title';
winnerTitle.innerHTML = `¬°${winnerName} ${getText('winner_msg')}!`;
// Mensaje adicional
let message = document.createElement('div');
message.className = 'winner-message';
message.innerHTML = "¬°Felicitaciones al campe√≥n!";
// Contenedor de part√≠culas
let particlesContainer = document.createElement('div');
particlesContainer.className = 'particles-container';
// Bot√≥n para cerrar
let closeButton = document.createElement('button');
closeButton.className = 'close-btn';
closeButton.innerText = 'Volver al Men√∫';
closeButton.onclick = function() {
document.body.removeChild(overlay);
navTo('menu');
};
overlay.appendChild(winnerTitle);
overlay.appendChild(message);
overlay.appendChild(particlesContainer);
overlay.appendChild(closeButton);
document.body.appendChild(overlay);
// Crear part√≠culas brillantes
createParticles(particlesContainer);
// A√±adir efecto de brillo adicional
setTimeout(() => {
winnerTitle.style.textShadow = '0 0 15px rgba(255,215,0,1), 0 0 30px rgba(255,215,0,0.9), 0 0 45px rgba(255,215,0,0.8)';
}, 500);
}
function createParticles(container) {
const colors = ['#FFD700', '#FFA500', '#FFFFFF', '#FFFFE0', '#FFC0CB'];
const totalParticles = 80;
for (let i = 0; i < totalParticles; i++) {
let particle = document.createElement('div');
particle.style.position = 'absolute';
particle.style.width = Math.random() * 15 + 5 + 'px';
particle.style.height = particle.style.width;
particle.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
particle.style.borderRadius = '50%';
particle.style.boxShadow = '0 0 10px ' + colors[Math.floor(Math.random() * colors.length)];
particle.style.opacity = Math.random() * 0.8 + 0.2;
// Posici√≥n aleatoria fuera de la pantalla
let side = Math.floor(Math.random() * 4); // 0:arriba, 1:derecha, 2:abajo, 3:izquierda
let posX, posY;
switch(side) {
case 0: // arriba
posX = Math.random() * 100 + '%';
posY = '-20px';
break;
case 1: // derecha
posX = '105%';
posY = Math.random() * 100 + '%';
break;
case 2: // abajo
posX = Math.random() * 100 + '%';
posY = '105%';
break;
default: // izquierda
posX = '-20px';
posY = Math.random() * 100 + '%';
}
particle.style.left = posX;
particle.style.top = posY;
// Animaci√≥n
let duration = Math.random() * 3 + 2;
let delay = Math.random() * 2;
particle.style.animation = `sparkle ${duration}s ease-in-out forwards ${delay}s`;
container.appendChild(particle);
// Eliminar part√≠cula despu√©s de la animaci√≥n
setTimeout(() => {
if (particle.parentNode) {
particle.parentNode.removeChild(particle);
}
// Recrear part√≠cula
setTimeout(() => {
createParticles(container);
}, Math.random() * 2000);
}, (duration + delay) * 1000);
}
}
// Inicializar Home
resetPlayersUI();
updateHomeText();
// Forzar HTTPS en producci√≥n
if (window.location.protocol !== 'https:' &&
window.location.hostname !== 'localhost' &&
window.location.hostname !== '127.0.0.1') {
window.location.protocol = 'https:';
}
// ----------------- INICIALIZACI√ìN -----------------
// Llamar a la funci√≥n para verificar autenticaci√≥n al cargar la p√°gina
document.addEventListener('DOMContentLoaded', function() {
checkAuthentication();
// Registrar service worker para PWA
if ('serviceWorker' in navigator) {
window.addEventListener('load', () => {
navigator.serviceWorker.register('/sw.js')
.then(registration => {
console.log('ServiceWorker registrado con √©xito:', registration.scope);
})
.catch(error => {
console.log('Error registrando ServiceWorker:', error);
});
});
}
});
</script>
</body>
</html>
