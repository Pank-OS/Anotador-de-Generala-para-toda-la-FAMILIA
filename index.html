<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="theme-color" content="#654321">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Generala Scorekeeper">
<link rel="manifest" href="manifest.json">
<meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' ; connect-src 'self'">
<title>Generala - Anotador</title>
<style>
/* ---------------- ESTILOS ---------------- */
:root {
--color-fondo: #D2B48C;       /* Madera claro */
--color-boton: #654321;       /* Marr√≥n oscuro base */
--color-boton-light: #7a5230; /* Marr√≥n m√°s claro para gradiente */
--color-texto-btn: #FFD700;   /* Dorado */
--color-texto: #3E2723;       /* Marr√≥n muy oscuro */
--color-row1: #C0C0C0;
--color-row2: #FFFFFF;
--color-bordo: #800000;       /* Color eliminaci√≥n */
--color-gold: #D4AF37;        /* Dorado antiguo */
--color-error: #D4AF37;       /* Dorado antiguo para errores */
--color-beige: #F5F5DC;       /* Beige para botones */
}
* {
box-sizing: border-box;
user-select: none;
-webkit-tap-highlight-color: transparent;
touch-action: manipulation;
}
body {
background-color: var(--color-fondo);
color: var(--color-texto);
font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
margin: 0;
padding: 0;
height: 100vh;
display: flex;
flex-direction: column;
overflow: hidden;
-webkit-font-smoothing: antialiased;
-moz-osx-font-smoothing: grayscale;
}
/* Pantallas */
.screen {
display: none;
flex-direction: column;
height: 100%;
padding: 20px;
overflow-y: auto;
}
.active {
display: flex;
-webkit-overflow-scrolling: touch;
}
/* Botones Sofisticados */
button {
background: linear-gradient(to bottom, var(--color-boton-light), var(--color-boton));
color: var(--color-texto-btn);
border: 1px solid #3e2723;
border-bottom: 4px solid #2a1a15; /* Efecto 3D */
padding: 15px;
font-size: 1.2rem;
font-weight: bold;
border-radius: 8px;
cursor: pointer;
box-shadow: 0px 4px 6px rgba(0,0,0,0.4);
transition: all 0.1s ease;
text-shadow: 1px 1px 0px rgba(0,0,0,0.5);
outline: none;
position: relative;
-webkit-appearance: none;
-moz-appearance: none;
}
/* Animaci√≥n de presi√≥n agradable */
button:active {
transform: translateY(3px); /* Se hunde */
border-bottom: 1px solid #2a1a15; /* Reduce el borde 3D */
box-shadow: 0px 1px 2px rgba(0,0,0,0.4);
filter: brightness(1.1); /* Brilla un poco */
}
button:disabled {
opacity: 0.5;
cursor: not-allowed;
transform: none;
border-bottom: 4px solid #2a1a15;
}
/* Inputs */
input[type="text"], input[type="password"], input[type="email"] {
padding: 12px;
font-size: 1.1rem;
border: 2px solid #654321;
border-radius: 6px;
background: #fff8e1;
color: var(--color-texto);
width: 100%;
font-weight: bold;
-webkit-appearance: none;
-moz-appearance: none;
}
/* Layouts utilitarios */
.v-box { display: flex; flex-direction: column; gap: 15px; }
.h-box { display: flex; flex-direction: row; gap: 10px; }
.center { align-items: center; justify-content: center; text-align: center; }
.spacer { flex: 1; }
/* --- HOME SCREEN --- */
#home-screen { justify-content: center; gap: 30px; }
.home-title {
font-size: 2.2rem;
font-weight: 900;
text-align: center;
color: #3E2723;
text-shadow: 1px 1px 0px #fff;
}
/* --- MENU SCREEN --- */
.player-row {
display: flex;
gap: 10px;
opacity: 0;
animation: slideIn 0.3s forwards;
margin-bottom: 10px;
}
@keyframes slideIn {
from { opacity: 0; transform: translateX(-20px); }
to { opacity: 1; transform: translateX(0); }
}
.color-btn {
width: 45%;
font-size: 1rem;
padding: 10px;
border-bottom-width: 3px;
/* El color de texto se define inline por JS */
text-shadow: none;
}
/* --- ANOTADOR SCREEN --- */
.turn-label {
font-size: 1.6rem;
font-weight: bold;
margin-bottom: 15px;
text-align: center;
background: rgba(255,255,255,0.3);
padding: 10px;
border-radius: 8px;
border: 2px solid #654321;
}
/* Contenedor con scroll horizontal para la tabla */
.score-container {
flex: 1;
overflow-x: auto;
position: relative;
box-shadow: 0 0 10px rgba(0,0,0,0.3);
border-radius: 8px;
margin-bottom: 15px;
}
/* Tabla de puntajes (Grid CSS) */
#score-grid {
display: grid;
gap: 2px;
background-color: #3E2723; /* Color de l√≠neas de divisi√≥n */
border: 4px solid #3E2723;
border-radius: 4px;
overflow: auto;
min-width: 100%;
box-shadow: inset 0 0 10px rgba(0,0,0,0.5);
}
.cell {
display: flex;
align-items: center;
justify-content: center;
padding: 4px;
font-weight: 800; /* Texto bien grueso */
font-size: 1.1rem;
min-width: 70px;
min-height: 50px;
position: relative;
text-align: center;
overflow: hidden;
}
/* Celdas de categor√≠as fijas durante el scroll */
.category-cell {
position: sticky;
left: 0;
z-index: 10;
box-shadow: 2px 0 5px rgba(0,0,0,0.2);
}
.player-header {
height: 85px !important;
overflow: visible !important;
position: relative;
}
.cell-btn {
width: 100%; height: 100%;
background: transparent !important;
border: none !important;
box-shadow: none !important;
color: inherit;
font-weight: inherit; font-size: inherit;
cursor: pointer; padding: 0; margin: 0;
position: absolute; top: 0; left: 0;
transform: none !important; /* Desactivar animaci√≥n de bot√≥n est√°ndar para celdas */
text-overflow: ellipsis;
white-space: nowrap;
overflow: hidden;
}
.cell-btn:active {
background-color: rgba(0,0,0,0.1) !important; /* Feedback visual sutil */
}
.header-col {
background-color: var(--color-fondo);
color: var(--color-texto);
font-size: 1rem;
font-weight: bold;
}
/* --- ESTILOS DE JUGADOR ELIMINADO --- */
.dead-cell {
background-color: var(--color-bordo) !important;
color: white !important; /* Texto base blanco sobre bord√≥ para contraste */
position: relative;
}
/* L√≠nea Negra (Diagonal) */
.dead-line-black::after {
content: "";
position: absolute;
top: 0; left: 0; width: 100%; height: 100%;
background: linear-gradient(to top right, transparent calc(50% - 2px), black calc(50% - 2px), black calc(50% + 2px), transparent calc(50% + 2px));
pointer-events: none;
}
/* L√≠nea Blanca (Diagonal - para jugador negro) */
.dead-line-white::after {
content: "";
position: absolute;
top: 0; left: 0; width: 100%; height: 100%;
background: linear-gradient(to top right, transparent calc(50% - 2px), white calc(50% - 2px), white calc(50% + 2px), transparent calc(50% + 2px));
pointer-events: none;
}
/* --- POPUPS / MODALS --- */
.modal-overlay {
position: fixed; top: 0; left: 0; width: 100%; height: 100%;
background: rgba(0,0,0,0.7);
backdrop-filter: blur(2px);
display: none; align-items: center; justify-content: center;
z-index: 1000;
}
.modal-content {
background: linear-gradient(to bottom, #fff, #f0f0f0);
padding: 25px;
width: 90%;
max-width: 400px;
max-height: 85vh;
overflow-y: auto;
border-radius: 12px;
display: flex; flex-direction: column; gap: 20px;
text-align: center;
color: black;
box-shadow: 0 10px 25px rgba(0,0,0,0.5);
border: 2px solid #654321;
}
.grid-colors, .grid-scores, .grid-lang {
display: grid;
grid-template-columns: repeat(3, 1fr);
gap: 12px;
}
.score-val-btn { 
    font-size: 1.4rem; 
    padding: 10px; 
    background-color: var(--color-beige); /* Beige background */
    border: 2px solid var(--color-gold); /* Golden border */
    border-radius: 6px;
    transition: all 0.2s ease;
    color: #3E2723;
}
.score-val-btn:hover {
    background-color: #e8e8c0;
    transform: translateY(-2px);
}
/* --- LOGIN SCREEN ESTYLES --- */
#login-screen {
justify-content: center;
gap: 25px;
}
.login-title {
font-size: 2.0rem;
font-weight: 900;
text-align: center;
color: #3E2723;
text-shadow: 1px 1px 0px #fff;
margin-bottom: 10px;
}
.login-container {
background: rgba(255,255,255,0.85);
border-radius: 15px;
padding: 25px;
box-shadow: 0 8px 20px rgba(0,0,0,0.3);
border: 2px solid #654321;
}
.login-field {
margin-bottom: 20px;
}
.login-field label {
display: block;
margin-bottom: 8px;
font-weight: bold;
color: #3E2723;
font-size: 1.1rem;
}
.login-error {
color: var(--color-gold);
font-weight: bold;
margin-top: 15px;
font-size: 1.05rem;
text-align: center;
display: none;
}
/* --- ESTILO CORONA --- */
.leader-crown {
position: absolute;
top: 8px;
left: 50%;
transform: translateX(-50%);
font-size: 1.4rem;
color: gold;
text-shadow: 0 0 5px gold, 0 0 8px gold;
z-index: 10;
display: flex;
justify-content: center;
align-items: center;
width: 100%;
height: 20px;
opacity: 0;
animation: crownAppear 0.8s forwards;
}
.crown-appear {
animation: crownAppear 0.8s forwards;
}
.crown-disappear {
animation: crownDisappear 0.5s forwards;
}
@keyframes crownAppear {
0% { opacity: 0; transform: translateX(-50%) scale(0.5); text-shadow: 0 0 0 gold; }
50% { opacity: 1; transform: translateX(-50%) scale(1.2); text-shadow: 0 0 5px gold; }
100% { opacity: 1; transform: translateX(-50%) scale(1); text-shadow: 0 0 5px gold, 0 0 8px gold; }
}
@keyframes crownDisappear {
0% { opacity: 1; transform: translateX(-50%) scale(1); text-shadow: 0 0 5px gold, 0 0 8px gold; }
100% { opacity: 0; transform: translateX(-50%) scale(0.8); text-shadow: 0 0 0 gold; }
}
/* --- MEDIA QUERIES PARA RESPONSIVE DESIGN --- */
@media (max-width: 768px) {
body {
font-size: 0.9rem;
}
.home-title {
font-size: 1.8rem;
}
button {
padding: 12px;
font-size: 1.0rem;
}
.player-row {
flex-direction: column;
}
.player-row input, .player-row .color-btn {
width: 100%;
}
.cell {
padding: 3px;
font-size: 0.95rem;
min-width: 60px; /* Aumentado para mejor legibilidad */
min-height: 45px; /* Ajustado */
}
.turn-label {
font-size: 1.4rem;
margin-bottom: 12px;
}
.leader-crown {
font-size: 1.0rem;
top: 5px;
}
.category-header-mobile {
font-size: 0.75rem !important;
}
.score-container {
margin: 0 -10px; /* Compensar el padding para scroll completo */
}
}
@media (max-width: 480px) {
body {
font-size: 0.85rem;
}
.home-title {
font-size: 1.5rem;
}
button {
padding: 8px;
font-size: 0.85rem;
}
.login-title, #lbl-lang-title {
font-size: 1.5rem;
}
.cell {
font-size: 0.85rem; /* Aumentado para mejor legibilidad */
min-width: 55px; /* Aumentado para mejor legibilidad */
min-height: 40px; /* Ajustado */
padding: 2px;
}
.turn-label {
font-size: 1.2rem;
}
.header-col {
font-size: 0.75rem;
}
.leader-crown {
font-size: 0.9rem;
top: 3px;
height: 18px;
}
.modal-content {
padding: 15px;
}
.score-val-btn {
font-size: 1.2rem;
padding: 8px;
}
.grid-colors, .grid-scores, .grid-lang {
gap: 8px;
}
}
@media (min-width: 1200px) {
.home-title {
font-size: 2.6rem;
}
button {
padding: 20px;
font-size: 1.4rem;
}
.cell {
font-size: 1.3rem;
min-width: 75px; /* Aumentado para mejor legibilidad */
min-height: 55px;
}
.turn-label {
font-size: 1.8rem;
}
}
/* --- ANIMACI√ìN VICTORIA --- */
#winner-overlay {
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
background-size: 400% 400%;
animation: gradientBG 15s ease infinite;
z-index: 3000;
display: flex;
flex-direction: column;
justify-content: center;
align-items: center;
color: white;
text-align: center;
font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
overflow: hidden;
}
@keyframes gradientBG {
0% { background-position: 0% 50%; }
50% { background-position: 100% 50%; }
100% { background-position: 0% 50%; }
}
.winner-title {
font-size: 3rem;
font-weight: 900;
color: gold;
text-shadow:
0 0 10px rgba(255,215,0,0.9),
0 0 20px rgba(255,215,0,0.8);
margin-bottom: 10px;
animation: glow 2s infinite alternate;
}
@keyframes glow {
from { text-shadow: 0 0 10px gold, 0 0 20px gold; }
to { text-shadow: 0 0 20px gold, 0 0 30px gold, 0 0 40px gold; }
}
.winner-message {
font-size: 1.8rem;
color: white;
margin-bottom: 30px;
text-shadow: 0 0 8px rgba(255,255,255,0.8);
}
.winner-summary {
width: 90%;
max-width: 800px;
background: rgba(0,0,0,0.7);
border-radius: 12px;
padding: 15px;
margin: 20px 0;
max-height: 50vh;
overflow-y: auto;
}
.summary-grid {
display: grid;
gap: 2px;
background-color: #3E2723;
border: 3px solid #3E2723;
border-radius: 4px;
overflow: hidden;
margin-top: 15px;
}
.summary-cell {
display: flex;
align-items: center;
justify-content: center;
padding: 4px;
font-weight: 700;
font-size: 0.9rem;
min-height: 35px;
text-align: center;
}
.summary-header {
background-color: #D2B48C;
color: #3E2723;
font-weight: bold;
}
.close-btn {
padding: 12px 30px;
font-size: 1.2rem;
background: linear-gradient(to bottom, gold, #daa520);
color: #3E2723;
border: none;
border-radius: 50px;
cursor: pointer;
box-shadow:
0 0 10px rgba(255,215,0,0.8),
0 0 20px rgba(255,215,0,0.6);
transition: all 0.3s ease;
margin-top: 15px;
font-weight: bold;
text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
}
.tie-message {
background: linear-gradient(45deg, #8B7500, #DAA520);
color: white;
padding: 15px;
border-radius: 10px;
margin: 20px 0;
font-size: 1.5rem;
font-weight: bold;
text-shadow: 0 0 10px rgba(218, 165, 32, 0.8);
box-shadow: 0 0 15px rgba(218, 165, 32, 0.5);
}
.close-btn:hover {
transform: scale(1.05);
box-shadow:
0 0 15px rgba(255,215,0,0.9),
0 0 25px rgba(255,215,0,0.8);
}
.close-btn:active {
transform: scale(0.98);
}
.confetti {
position: absolute;
width: 15px;
height: 15px;
background-color: #f00;
opacity: 0;
}
@keyframes confettiFall {
0% { transform: translateY(-100vh) rotate(0deg); opacity: 1; }
100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
}
</style>
</head>
<body>
<div id="login-screen" class="screen active">
<div class="login-title">üîí Acceso Restringido</div>
<div class="login-container">
<div class="login-field">
<label for="password-input">Contrase√±a:</label>
<input type="password" id="password-input" placeholder="Ingresa la contrase√±a">
</div>
<div class="login-field">
<label for="email-input">Correo Electr√≥nico:</label>
<input type="email" id="email-input" placeholder="tuemail@example.com">
</div>
<button id="login-btn" onclick="validateLogin()">Acceder al Juego</button>
<div id="login-error" class="login-error">Contrase√±a o correo incorrecto</div>
</div>
</div>
<div id="home-screen" class="screen">
<div class="home-title" id="lbl-home-welcome">BIENVENIDOS AL ANOTADOR DE GENERALA</div>
<div class="spacer"></div>
<button id="btn-home-start" onclick="navTo('menu')" style="font-size: 1.5rem; padding: 25px;">COMENZAR</button>
<button id="btn-home-lang" onclick="navTo('language')">SELECCIONAR IDIOMA</button>
<div class="spacer"></div>
</div>
<div id="language-screen" class="screen">
<div class="home-title" id="lbl-lang-title" style="margin-bottom: 20px; font-size: 1.8rem;">Elegir Idioma</div>
<div class="grid-lang" id="lang-grid-container" style="flex:1; overflow-y:auto; padding: 5px;">
</div>
<button id="btn-lang-back" onclick="navTo('home')" style="margin-top: 20px;">Volver al Men√∫</button>
</div>
<div id="menu-screen" class="screen">
<div style="flex-direction:row; justify-content: space-between; align-items: center; height: 60px;">
<span id="lbl-menu-welcome" style="font-size:1.4rem; font-weight:900; color: #3E2723;">Bienvenido</span>
</div>
<div id="players-container" style="flex: 1; overflow-y: auto; padding: 10px 0;">
</div>
<div class="v-box">
<div class="h-box">
<button onclick="addPlayerWidget()" style="flex:1; font-size:1.8rem;">+</button>
<button onclick="removePlayerWidget()" style="flex:1; font-size:1.8rem;">-</button>
</div>
<button id="btn-new-game" onclick="startGame()">Nueva Partida</button>
<button id="btn-load-game" onclick="loadGame()">Cargar Partida</button>
<button id="btn-menu-back" onclick="navTo('home')">Volver al Men√∫</button>
</div>
</div>
<div id="anotador-screen" class="screen">
<div id="turn-label" class="turn-label">Turno de:</div>
<div class="score-container">
<div id="score-grid">
</div>
</div>
<button id="btn-anotador-back" onclick="navTo('menu')" style="margin-top:15px;">Volver al Men√∫</button>
</div>
<div id="modal-generic" class="modal-overlay">
<div class="modal-content">
<h3 id="modal-title" style="font-size: 1.5rem; margin:0; color:#3E23;">Titulo</h3>
<div id="modal-body" style="font-size: 1.2rem;">Cuerpo</div>
<div class="h-box" id="modal-buttons" style="justify-content: center; margin-top:10px;">
<button onclick="closeModal()">OK</button>
</div>
</div>
</div>
<script>
// ----------------- SONIDO MEJORADO (Web Audio API) -----------------
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
function playSound() {
// Sonido "Pop" adictivo y notorio
if (audioCtx.state === 'suspended') audioCtx.resume();
const t = audioCtx.currentTime;
const oscillator = audioCtx.createOscillator();
const gainNode = audioCtx.createGain();
oscillator.connect(gainNode);
gainNode.connect(audioCtx.destination);
// Tipo de onda: Sine (suave) pero con una ca√≠da r√°pida de frecuencia para el "golpe"
oscillator.type = 'sine';
// Frecuencia: Empieza alto (800Hz) y cae a bajo (150Hz) muy r√°pido
oscillator.frequency.setValueAtTime(800, t);
oscillator.frequency.exponentialRampToValueAtTime(150, t + 0.1);
// Volumen: Ataque instant√°neo y decaimiento exponencial sin "click" al final
gainNode.gain.setValueAtTime(0, t);
gainNode.gain.linearRampToValueAtTime(0.8, t + 0.01); // Volumen m√°s alto
gainNode.gain.exponentialRampToValueAtTime(0.01, t + 0.15);
oscillator.start(t);
oscillator.stop(t + 0.16);
}
// Agregar sonido a todos los botones del documento
document.addEventListener('click', function(e) {
// Si es un bot√≥n o est√° dentro de un bot√≥n
if(e.target.tagName === 'BUTTON' || e.target.closest('button')) {
playSound();
}
});
// ----------------- SISTEMA DE SEGURIDAD -----------------
const AUTHORIZED_EMAILS = [
"franciscojcanestro@gmail.com",
"javier.canestro@gmail.com",
"ineslogioco@gmail.com",
"juanacanestro@gmail.com",
"camilacanestro@gmail.com",
"benitocanestro@gmail.com",
"mateocanestro@gmail.com",
"pedrojcanestro@gmail.com"
];
const ACCESS_PASSWORD = "4444";
// Funci√≥n para resetear la autenticaci√≥n
function resetAuthentication() {
localStorage.removeItem('generala_authenticated');
localStorage.removeItem('generala_secure_data');
localStorage.removeItem('generala_access_logs');
}
// Llamar a la funci√≥n para resetear al cargar la p√°gina
resetAuthentication();
function validateLogin() {
const passwordInput = document.getElementById('password-input').value.trim();
const emailInput = document.getElementById('email-input').value.trim().toLowerCase();
const errorElement = document.getElementById('login-error');
// Verificar autenticaci√≥n
if (passwordInput === ACCESS_PASSWORD && AUTHORIZED_EMAILS.includes(emailInput)) {
// Guardar en localStorage que este usuario est√° autorizado
localStorage.setItem('generala_authenticated', JSON.stringify({
email: emailInput,
timestamp: new Date().toISOString()
}));
// Enviar notificaci√≥n de acceso
sendAccessNotification(emailInput);
// Ir a la pantalla de inicio
navTo('home');
} else {
// Mostrar error en color dorado
errorElement.style.color = 'var(--color-gold)';
errorElement.style.display = 'block';
setTimeout(() => {
errorElement.style.display = 'none';
}, 3000);
}
}
// Verificar si el usuario ya est√° autenticado al cargar la p√°gina
function checkAuthentication() {
const authData = localStorage.getItem('generala_authenticated');
if (authData) {
try {
const parsedData = JSON.parse(authData);
// Verificar que el correo a√∫n est√© autorizado
if (AUTHORIZED_EMAILS.includes(parsedData.email.toLowerCase())) {
// Ya est√° autenticado, ir directamente a home
navTo('home');
return;
}
} catch (e) {
console.error("Error parsing auth data", e);
}
}
// Si no est√° autenticado, mostrar pantalla de login
navTo('login');
}
// Funci√≥n para enviar notificaci√≥n de acceso (simulaci√≥n)
function sendAccessNotification(email) {
// En un entorno real, esto se conectar√≠a con un backend para enviar un email
// Para este ejemplo, solo lo registramos en la consola y almacenamos en localStorage
console.log(`Nuevo acceso: ${email} en ${new Date().toISOString()}`);
// Almacenar en localStorage para registro
let accessLogs = JSON.parse(localStorage.getItem('generala_access_logs') || '[]');
accessLogs.push({
email: email,
timestamp: new Date().toISOString()
});
// Mantener solo los √∫ltimos 50 registros para no saturar el localStorage
if (accessLogs.length > 50) {
accessLogs = accessLogs.slice(-50);
}
localStorage.setItem('generala_access_logs', JSON.stringify(accessLogs));
}
// ----------------- SEGURIDAD ADICIONAL -----------------
function sanitizeInput(input) {
const div = document.createElement('div');
div.textContent = input;
return div.innerHTML;
}
function saveGameSecure() {
const data = {
names: app.jugadores,
scores: app.puntajes,
colors: app.jugador_colores, // A√±adir colores para persistencia
currentTurn: app.current_turn // Guardar el turno actual
};
// Encriptaci√≥n b√°sica (para mejor seguridad, usar librer√≠a como CryptoJS)
const encrypted = btoa(JSON.stringify(data));
localStorage.setItem('generala_secure_data', encrypted);
}
function loadGameSecure() {
const encrypted = localStorage.getItem('generala_secure_data');
if (encrypted) {
try {
const decrypted = JSON.parse(atob(encrypted));
app.jugadores = decrypted.names || [];
app.puntajes = decrypted.scores || {};
app.current_turn = decrypted.currentTurn || 0; // Restaurar el turno actual
// Cargar colores si existen, de lo contrario usar valores por defecto
app.jugador_colores = decrypted.colors || app.jugador_colores.slice(0, app.jugadores.length);
return true;
} catch (e) {
console.error("Error decrypting ", e);
return false;
}
}
return false;
}
// ----------------- DATOS Y CONFIGURACI√ìN -----------------
const color_names = {
"es": {"red": "Rojo", "blue": "Azul", "green": "Verde", "orange": "Naranja", "purple": "P√∫rpura", "brown": "Marr√≥n", "magenta": "Magenta", "cyan": "Cian", "yellow": "Amarillo", "deeppink": "Rosa", "gold": "Dorado", "turquoise": "Turquesa", "silver": "Plateado", "black": "Negro"},
"en": {"red": "Red", "blue": "Blue", "green": "Green", "orange": "Orange", "purple": "Purple", "brown": "Brown", "magenta": "Magenta", "cyan": "Cyan", "yellow": "Yellow", "deeppink": "Deep Pink", "gold": "Gold", "turquoise": "Turquoise", "silver": "Silver", "black": "Black"},
"en-US": {"red": "Red", "blue": "Blue", "green": "Green", "orange": "Orange", "purple": "Purple", "brown": "Brown", "magenta": "Magenta", "cyan": "Cyan", "yellow": "Yellow", "deeppink": "Deep Pink", "gold": "Gold", "turquoise": "Turquoise", "silver": "Silver", "black": "Black"},
"pt": {"red": "Vermelho", "blue": "Azul", "green": "Verde", "orange": "Laranja", "purple": "Roxo", "brown": "Marrom", "magenta": "Magenta", "cyan": "Ciano", "yellow": "Amarelo", "deeppink": "Rosa", "gold": "Dourado", "turquoise": "Turquesa", "silver": "Prata", "black": "Preto"},
"fr": {"red": "Rouge", "blue": "Blue", "green": "Vert", "orange": "Orange", "purple": "Violet", "brown": "Marron", "magenta": "Magenta", "cyan": "Cyan", "yellow": "Jaune", "deeppink": "Rose Fonc√©", "gold": "Or", "turquoise": "Turquoise", "silver": "Argent", "black": "Noir"},
"id": {"red": "Merah", "blue": "Biru", "green": "Hijau", "orange": "Oranye", "purple": "Ungu", "brown": "Coklat", "magenta": "Magenta", "cyan": "Sian", "yellow": "Kuning", "deeppink": "Merah Muda", "gold": "Emas", "turquoise": "Turkis", "silver": "Perak", "black": "Hitam"},
"de": {"red": "Rot", "blue": "Blau", "green": "Gr√ºn", "orange": "Orange", "purple": "Lila", "brown": "Braun", "magenta": "Magenta", "cyan": "Cyan", "yellow": "Gelb", "deeppink": "Dunkelpink", "gold": "Gold", "turquoise": "T√ºrkis", "silver": "Silber", "black": "Schwarz"},
"tr": {"red": "Kƒ±rmƒ±zƒ±", "blue": "Mavi", "green": "Ye≈üil", "orange": "Turuncu", "purple": "Mor", "brown": "Kahverengi", "magenta": "Macenta", "cyan": "Cam mavisi", "yellow": "Sarƒ±", "deeppink": "Derin Pembe", "gold": "Altƒ±n", "turquoise": "Turkuaz", "silver": "G√ºm√º≈ü", "black": "Siyah"},
"it": {"red": "Rosso", "blue": "Blue", "green": "Verde", "orange": "Arancione", "purple": "Viola", "brown": "Marrone", "magenta": "Magenta", "cyan": "Ciano", "yellow": "Giallo", "deeppink": "Rosa Intenso", "gold": "Oro", "turquoise": "Turchese", "silver": "Argento", "black": "Nero"},
"pl": {"red": "Czerwony", "blue": "Niebieski", "green": "Zielony", "orange": "Pomara≈Ñczowy", "purple": "Fioletowy", "brown": "BrƒÖzowy", "magenta": "Magenta", "cyan": "Cyjan", "yellow": "≈ª√≥≈Çty", "deeppink": "Jasnor√≥≈ºowy", "gold": "Z≈Çoty", "turquoise": "Turkusowy", "silver": "Srebrny", "black": "Czarny"},
"vi": {"red": "ƒê·ªè", "blue": "Xanh d∆∞∆°ng", "green": "Xanh l√°", "orange": "Cam", "purple": "T√≠m", "brown": "N√¢u", "magenta": "Magenta", "cyan": "Xanh l∆°", "yellow": "V√†ng", "deeppink": "H·ªìng ƒë·∫≠m", "gold": "V√†ng √≥ng", "turquoise": "Xanh ng·ªçc", "silver": "B·∫°c", "black": "ƒêen"},
"nl": {"red": "Rood", "blue": "Blauw", "green": "Groen", "orange": "Oranje", "purple": "Paars", "brown": "Bruin", "magenta": "Magenta", "cyan": "Cyaan", "yellow": "Geel", "deeppink": "Diep Roze", "gold": "Goud", "turquoise": "Turkoois", "silver": "Zilver", "black": "Zwart"},
"ro": {"red": "Ro»ôu", "blue": "Albastru", "green": "Verde", "orange": "Portocaliu", "purple": "Mov", "brown": "Maro", "magenta": "Magenta", "cyan": "Cian", "yellow": "Galben", "deeppink": "Roz intens", "gold": "Auriu", "turquoise": "Turcoaz", "silver": "Argintiu", "black": "Negru"},
"zh": {"red": "Á∫¢Ëâ≤", "blue": "ËìùËâ≤", "green": "ÁªøËâ≤", "orange": "Ê©ôËâ≤", "purple": "Á¥´Ëâ≤", "brown": "Ê£ïËâ≤", "magenta": "Ê¥ãÁ∫¢Ëâ≤", "cyan": "ÈùíËâ≤", "yellow": "ÈªÑËâ≤", "deeppink": "Ê∑±Á≤âËâ≤", "gold": "ÈáëËâ≤", "turquoise": "ÁªøÊùæÁü≥Ëâ≤", "silver": "Èì∂Ëâ≤", "black": "ÈªëËâ≤"}
};
const translations = {
"es": {"home_welcome": "BIENVENIDOS AL ANOTADOR DE GENERALA", "home_title": "COMENZAR", "home_lang": "SELECCIONAR IDIOMA", "welcome": "Bienvenidos al Anotador de Generala", "player_name_hint": "Nombre del jugador (m√°x 6)", "new_game": "Nueva Partida", "load_game": "Cargar Partida", "back_to_menu": "Volver al Men√∫", "turn_of": "Turno de:", "select_color": "Seleccionar Color", "select_score": "Seleccionar Puntaje", "error": "Error", "choose_language": "Elegir Idioma", "confirm": "Confirmar", "confirm_turn": "¬øSeguro que quieres anotar en {target} siendo turno de {current}?", "yes": "S√≠", "no": "No", "max_players": "M√°ximo 10 jugadores.", "min_players": "M√≠nimo 2 jugadores.", "no_saved_game": "No hay partida guardada.", "category_header": "Categor√≠a", "category_header_mobile": "Categ.", "scratch": "Tachar", "end_game": "Fin del Juego", "winner_msg": "ha ganado!!", "congrats": "¬°Felicitaciones al campe√≥n!", "tie_message": "han empatado, ¬°felicidades a los campeones!!" },
"en": {"home_welcome": "WELCOME TO THE GENERALA SCOREKEEPER", "home_title": "START", "home_lang": "SELECT LANGUAGE", "welcome": "Welcome to the Generala Scorekeeper", "player_name_hint": "Player Name (max 6)", "new_game": "New Game", "load_game": "Load Game", "back_to_menu": "Back to Menu", "turn_of": "Turn of:", "select_color": "Select Color", "select_score": "Select Score", "error": "Error", "choose_language": "Choose Language", "confirm": "Confirm", "confirm_turn": "Are you sure you want to score on {target} while it is {current}'s turn?", "yes": "Yes", "no": "No", "max_players": "Maximum 10 players.", "min_players": "Minimum 2 players.", "no_saved_game": "No saved game found.", "category_header": "Category", "category_header_mobile": "Categ.", "scratch": "Scratch", "end_game": "End of the Game", "winner_msg": "has won!!", "congrats": "Congratulations to the champion!", "tie_message": "have tied, congratulations to the champions!!" },
"en-US": {"home_welcome": "WELCOME TO THE YAHTZEE SCOREKEEPER", "home_title": "START", "home_lang": "SELECT LANGUAGE", "welcome": "Welcome to the Yahtzee Scorekeeper", "player_name_hint": "Player Name (max 6)", "new_game": "New Game", "load_game": "Load Game", "back_to_menu": "Back to Menu", "turn_of": "Turn of:", "select_color": "Select Color", "select_score": "Select Score", "error": "Error", "choose_language": "Choose Language", "confirm": "Confirm", "confirm_turn": "Are you sure you want to score on {target} while it is {current}'s turn?", "yes": "Yes", "no": "No", "max_players": "Maximum 10 players.", "min_players": "Minimum 2 players.", "no_saved_game": "No saved game found.", "category_header": "Category", "category_header_mobile": "Categ.", "scratch": "Scratch", "end_game": "End of the Game", "winner_msg": "has won!!", "congrats": "Congratulations to the champion!", "tie_message": "have tied, congratulations to the champions!!" },
"pt": {"home_welcome": "BEM-VINDO AO CONTADOR DE GENERALA", "home_title": "COME√áAR", "home_lang": "SELECCIONAR IDIOMA", "welcome": "Bem-vindo ao Marcador de Generala", "player_name_hint": "Nome do jogador (m√°x 6)", "new_game": "Novo Jogo", "load_game": "Carregar Jogo", "back_to_menu": "Voltar ao Menu", "turn_of": "Vez de:", "select_color": "Selecionar Cor", "select_score": "Selecionar Pontua√ß√£o", "error": "Erro", "choose_language": "Escolher Idioma", "confirm": "Confirmar", "confirm_turn": "Tem certeza de que deseja anotar em {target} enquanto √© a vez de {current}?", "yes": "Sim", "no": "N√£o", "max_players": "M√°ximo de 10 jogadores.", "min_players": "M√≠nimo de 2 jogadores.", "no_saved_game": "Nenhum jogo salvo.", "category_header": "Categoria", "category_header_mobile": "Categ.", "scratch": "Tachar", "end_game": "Fim do Jogo", "winner_msg": "venceu!!", "congrats": "Parab√©ns ao campe√£o!", "tie_message": "empataram, parab√©ns aos campe√µes!!" },
"fr": {"home_welcome": "BIENVENUE DANS LE COMPTEUR DE GENERALA", "home_title": "COMMENCER", "home_lang": "CHOISIR LA LANGUE", "welcome": "Bienvenue sur le compteur de Generala", "player_name_hint": "Nom du joueur (max 6)", "new_game": "Nouvelle Partie", "load_game": "Charger la Partie", "back_to_menu": "Retour au Menu", "turn_of": "√Ä vous de jouer:", "select_color": "Choisir la Couleur", "select_score": "Choisir le Score", "error": "Erreur", "choose_language": "Choisir la Langue", "confirm": "Confirmer", "confirm_turn": "√ätes-vous s√ªr de vouloir enregistrer le score sur {target} alors que c'est le tour de {current} ?", "yes": "Oui", "no": "Non", "max_players": "Maximum 10 joueurs.", "min_players": "Minimum 2 joueurs.", "no_saved_game": "Aucune partie sauvegard√©e.", "category_header": "Cat√©gorie", "category_header_mobile": "Categ.", "scratch": "Effacer", "end_game": "Fin du Jeu", "winner_msg": "a gagn√©!!", "congrats": "F√©licitations au champion!", "tie_message": "ont fait match nul, f√©licitations aux champions!!" },
"id": {"home_welcome": "SELAMAT DATANG DI PENCATAT GENERALA", "home_title": "MULAI", "home_lang": "PILIH BAHASA", "welcome": "Selamat datang di Pembukuan Generala", "player_name_hint": "Nama Pemain (maks 6)", "new_game": "Permainan Baru", "load_game": "Muat Permainan", "back_to_menu": "Kembali ke Menu", "turn_of": "Giliran:", "select_color": "Pilih Warna", "select_score": "Pilih Skor", "error": "Kesalahan", "choose_language": "Pilih Bahasa", "confirm": "Konfirmasi", "confirm_turn": "Apakah Anda yakin ingin mencatat skor di {target} sementara giliran {current}?", "yes": "Ya", "no": "Tidak", "max_players": "Maksimal 10 pemain.", "min_players": "Minimal 2 pemain.", "no_saved_game": "Tidak ada permainan tersimpan.", "category_header": "Kategori", "category_header_mobile": "Categ.", "scratch": "Hapus", "end_game": "Permainan Selesai", "winner_msg": "menang!!", "congrats": "Selamat kepada sang juara!", "tie_message": "seri, selamat kepada para juara!!" },
"de": {"home_welcome": "WILLKOMMEN BEIM GENERALA-SCOREKEEPER", "home_title": "STARTEN", "home_lang": "SPRACHE W√ÑHLEN", "welcome": "Willkommen beim Generala-Punkteverwalter", "player_name_hint": "Spielername (max 6)", "new_game": "Neues Spiel", "load_game": "Spiel Laden", "back_to_menu": "Zur√ºck zum Men√º", "turn_of": "Am Zug:", "select_color": "Farbe ausw√§hlen", "select_score": "Punktzahl ausw√§hlen", "error": "Fehler", "choose_language": "Sprache w√§hlen", "confirm": "Best√§tigen", "confirm_turn": "Bist du sicher, dass du bei {target} Punkte notieren m√∂chtest, w√§hrend {current} am Zug ist?", "yes": "Ja", "no": "Nein", "max_players": "Maximum 10 Spieler.", "min_players": "Minimum 2 Spieler.", "no_saved_game": "Kein gespeichertes Spiel gefunden.", "category_header": "Kategorie", "category_header_mobile": "Categ.", "scratch": "L√∂schen", "end_game": "Spiel Ende", "winner_msg": "hat gewonnen!!", "congrats": "Gl√ºckwunsch an den Champion!", "tie_message": "haben gleichgezogen, Gl√ºckwunsch an die Champions!!" },
"tr": {"home_welcome": "GENERALA PUAN TABLOSUNA HO≈û GELDƒ∞Nƒ∞Z", "home_title": "BA≈ûLA", "home_lang": "Dƒ∞Lƒ∞ SE√á", "welcome": "Generala Puan Tablosuna Ho≈ügeldiniz", "player_name_hint": "Oyuncu Adƒ± (maks 6)", "new_game": "Yeni Oyun", "load_game": "Oyunu Y√ºkle", "back_to_menu": "Men√ºye D√∂n", "turn_of": "Sƒ±ra:", "select_color": "Renk Se√ß", "select_score": "Puan Se√ß", "error": "Hata", "choose_language": "Dil Se√ß", "confirm": "Onayla", "confirm_turn": "{target} i√ßin puan eklemek istediƒüinizden emin misiniz? Sƒ±ra {current}.", "yes": "Evet", "no": "Hayƒ±r", "max_players": "Maksimum 10 oyuncu.", "min_players": "Minimum 2 oyuncu.", "no_saved_game": "Kayƒ±tlƒ± oyun bulunamadƒ±.", "category_header": "Kategori", "category_header_mobile": "Categ.", "scratch": "Sil", "end_game": "Oyunun Sonu", "winner_msg": "kazandƒ±!!", "congrats": "≈ûampiyona tebrikler!", "tie_message": "berabere kaldƒ±lar, ≈üampiyonlara tebrikler!!" },
"it": {"home_welcome": "BENVENUTI AL REGISTRATORE DI GENERALA", "home_title": "INIZIA", "home_lang": "SELEZIONA LINGUA", "welcome": "Benvenuti al Segnapunti di Generala", "player_name_hint": "Nome del giocatore (max 6)", "new_game": "Nuova Partita", "load_game": "Carica Partita", "back_to_menu": "Torna al Men√π", "turn_of": "Tocca a:", "select_color": "Seleziona Colore", "select_score": "Seleziona Punteggio", "error": "Errore", "choose_language": "Scegli Lingua", "confirm": "Conferma", "confirm_turn": "Sei sicuro di voler annotare il punteggio per {target} mentre tocca a {current}?", "yes": "S√¨", "no": "No", "max_players": "Massimo 10 giocatori.", "min_players": "Minimo 2 giocatori.", "no_saved_game": "Nessuna partita salvata.", "category_header": "Categoria", "category_header_mobile": "Categ.", "scratch": "Cancella", "end_game": "Fine del Gioco", "winner_msg": "ha vinto!!", "congrats": "Congratulazioni al campione!", "tie_message": "hanno pareggiato, congratulazioni ai campioni!!" },
"pl": {"home_welcome": "WITAMY W GENERALA SCOREKEEPER", "home_title": "START", "home_lang": "WYBIERZ JƒòZYK", "welcome": "Witamy w notatniku do Generala", "player_name_hint": "Imiƒô gracza (maks 6)", "new_game": "Nowa Gra", "load_game": "Wczytaj Grƒô", "back_to_menu": "Powr√≥t do Menu", "turn_of": "Ruch:", "select_color": "Wybierz kolor", "select_score": "Wybierz wynik", "error": "B≈ÇƒÖd", "choose_language": "Wybierz jƒôzyk", "confirm": "Potwierd≈∫", "confirm_turn": "Czy na pewno chcesz zanotowaƒá wynik dla {target}, podczas gdy kolej {current}?", "yes": "Tak", "no": "Nie", "max_players": "Maksymalnie 10 graczy.", "min_players": "Minimalnie 2 graczy.", "no_saved_game": "Nie znaleziono zapisanej gry.", "category_header": "Kategoria", "category_header_mobile": "Categ.", "scratch": "Skre≈õl", "end_game": "Koniec Gry", "winner_msg": "wygra≈Ç!!", "congrats": "Gratulacje dla mistrza!", "tie_message": "zremisowali, gratulacje mistrzom!!" },
"vi": {"home_welcome": "CH√ÄO M·ª™NG ƒê·∫æN V·ªöI B·∫¢NG ƒêI·ªÇM GENERALA", "home_title": "B·∫ÆT ƒê·∫¶U", "home_lang": "CH·ªåN NG√îN NG·ªÆ", "welcome": "Ch√†o m·ª´ng ƒë·∫øn v·ªõi B·∫£ng Ghi ƒêi·ªÉm Generala", "player_name_hint": "T√™n ng∆∞·ªùi ch∆°i (t·ªëi ƒëa 6)", "new_game": "Tr√≤ ch∆°i M·ªõi", "load_game": "T·∫£i Tr√≤ Ch∆°i", "back_to_menu": "Quay l·∫°i Menu", "turn_of": "L∆∞·ª£t c·ªßa:", "select_color": "Ch·ªçn M√†u", "select_score": "Ch·ªçn ƒêi·ªÉm s·ªë", "error": "L·ªói", "choose_language": "Ch·ªçn Ng√¥n ng·ªØ", "confirm": "X√°c nh·∫≠n", "confirm_turn": "B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën ghi ƒëi·ªÉm cho {target} trong khi ƒë·∫øn l∆∞·ª£t {current} kh√¥ng?", "yes": "V√¢ng", "no": "Kh√¥ng", "max_players": "T·ªëi ƒëa 10 ng∆∞·ªùi ch∆°i.", "min_players": "T·ªëi thi·ªÉu 2 ng∆∞·ªùi ch∆°i.", "no_saved_game": "Kh√¥ng c√≥ tr√≤ ch∆°i ƒë∆∞·ª£c l∆∞u.", "category_header": "Lo·∫°i", "category_header_mobile": "Lo·∫°i", "scratch": "Xo√°", "end_game": "K·∫øt th√∫c tr√≤ ch∆°i", "winner_msg": "ƒë√£ th·∫Øng!!", "congrats": "Ch√∫c m·ª´ng nh√† v√¥ ƒë·ªãch!", "tie_message": "ƒë√£ h√≤a, ch√∫c m·ª´ng c√°c nh√† v√¥ ƒë·ªãch!!" },
"nl": {"home_welcome": "WELKOM BIJ DE GENERALA SCOREKEEPER", "home_title": "START", "home_lang": "TAAL SELECTEREN", "welcome": "Welkom bij de Generala Scorekeeper", "player_name_hint": "Spelersnaam (max 6)", "new_game": "Nieuw Spel", "load_game": "Spel Laden", "back_to_menu": "Terug naar Menu", "turn_of": "Beurt van:", "select_color": "Selecteer Kleur", "select_score": "Selecteer Score", "error": "Fout", "choose_language": "Kies Taal", "confirm": "Bevestigen", "confirm_turn": "Weet je zeker dat je punten wilt noteren voor {target} terwijl het de beurt is van {current}?", "yes": "Ja", "no": "Nee", "max_players": "Maximaal 10 spelers.", "min_players": "Minimaal 2 spelers.", "no_saved_game": "Geen opgeslagen spel gevonden.", "category_header": "Categorie", "category_header_mobile": "Categ.", "scratch": "Doorstrepen", "end_game": "Einde van het Spel", "winner_msg": "heeft gewonnen!!", "congrats": "Gefeliciteerd aan de kampioen!", "tie_message": "hebben gelijk gespeeld, gefeliciteerd aan de kampioenen!!" },
"ro": {"home_welcome": "BINE A»öI VENIT LA TABELUL DE SCOR GENERALA", "home_title": "PORNE»òTE", "home_lang": "SELECTEAZƒÇ LIMBA", "welcome": "Bine a»õi venit la Tabelul de Scor Generala", "player_name_hint": "Numele jucƒÉtorului (max 6)", "new_game": "Joc Nou", "load_game": "√éncarcƒÉ Joc", "back_to_menu": "√énapoi la Meniu", "turn_of": "R√¢ndul lui:", "select_color": "SelecteazƒÉ Culoare", "select_score": "SelecteazƒÉ Scor", "error": "Eroare", "choose_language": "Alege Limba", "confirm": "ConfirmƒÉ", "confirm_turn": "E»ôti sigur cƒÉ vrei sƒÉ notezi scorul la {target} √Æn timp ce este r√¢ndul lui {current}?", "yes": "Da", "no": "Nu", "max_players": "Maximum 10 jucƒÉtori.", "min_players": "Minimum 2 jucƒÉtori.", "no_saved_game": "Niciun joc salvat gƒÉsit.", "category_header": "Categorie", "category_header_mobile": "Categ.", "scratch": "AnuleazƒÉ", "end_game": "Sf√¢r»ôitul Jocului", "winner_msg": "a c√¢»ôtigat!!", "congrats": "FelicitƒÉri campionului!", "tie_message": "au fƒÉcut egalitate, felicitƒÉri campionilor!!" },
"zh": {"home_welcome": "Ê¨¢Ëøé‰ΩøÁî®GENERALAËÆ∞ÂàÜÂëò", "home_title": "ÂºÄÂßã", "home_lang": "ÈÄâÊã©ËØ≠Ë®Ä", "welcome": "Ê¨¢Ëøé‰ΩøÁî®GeneralaËÆ∞ÂàÜÂëò", "player_name_hint": "Áé©ÂÆ∂ÂêçÁß∞ (ÊúÄÂ§ö6‰∏™Â≠óÁ¨¶)", "new_game": "Êñ∞Ê∏∏Êàè", "load_game": "Âä†ËΩΩÊ∏∏Êàè", "back_to_menu": "ËøîÂõûËèúÂçï", "turn_of": "ËΩÆÂà∞Ôºö", "select_color": "ÈÄâÊã©È¢úËâ≤", "select_score": "ÈÄâÊã©ÂàÜÊï∞", "error": "ÈîôËØØ", "choose_language": "ÈÄâÊã©ËØ≠Ë®Ä", "confirm": "Á°ÆËÆ§", "confirm_turn": "ÊÇ®Á°ÆÂÆöË¶Å‰∏∫{target}ËÆ∞ÂàÜÔºåËÄåËΩÆÂà∞{current}Ôºü", "yes": "ÊòØ", "no": "Âê¶", "max_players": "ÊúÄÂ§ö10ÂêçÁé©ÂÆ∂„ÄÇ", "min_players": "ÊúÄÂ∞ë2ÂêçÁé©ÂÆ∂„ÄÇ", "no_saved_game": "Êú™ÊâæÂà∞Â∑≤‰øùÂ≠òÁöÑÊ∏∏Êàè„ÄÇ", "category_header": "Á±ªÂà´", "category_header_mobile": "Á±ª.", "scratch": "ÂàíÊéâ", "end_game": "Ê∏∏ÊàèÁªìÊùü", "winner_msg": "Ëé∑ËÉúÔºÅÔºÅ", "congrats": "ÂêëÂÜ†ÂÜõË°®Á§∫Á•ùË¥∫ÔºÅ", "tie_message": "Â∑≤Âπ≥Â±ÄÔºåÂêëÂÜ†ÂÜõ‰ª¨Ë°®Á§∫Á•ùË¥∫ÔºÅÔºÅ" }
};
// Orden correcto de categor√≠as: Categ. 1, 2, 3, 4, 5, 6, Esc., Full., Pok., Gen., 2Gen., y luego Total como fila separada
const categories_translations = {
"es": ["Categ.", "1", "2", "3", "4", "5", "6", "ESC.", "FULL.", "POK.", "GEN.", "GEN2"],
"en": ["Categ.", "1", "2", "3", "4", "5", "6", "STR.", "FULL.", "POK.", "GEN.", "GEN2"],
"en-US": ["Categ.", "1", "2", "3", "4", "5", "6", "STR.", "FULL.", "POK.", "YAHTZEE", "YAHTZEE2"],
"pt": ["Categ.", "1", "2", "3", "4", "5", "6", "ESC.", "FULL.", "POK.", "GEN.", "GEN2"],
"fr": ["Categ.", "1", "2", "3", "4", "5", "6", "SUITE", "FULL.", "POK.", "GEN.", "GEN2"],
"id": ["Categ.", "1", "2", "3", "4", "5", "6", "TANGGA", "FULL.", "POK.", "GEN.", "GEN2"],
"de": ["Categ.", "1", "2", "3", "4", "5", "6", "STR.", "FULL.", "POK.", "GEN.", "GEN2"],
"tr": ["Categ.", "1", "2", "3", "4", "5", "6", "D√úZ", "FULL.", "POK.", "GEN.", "GEN2"],
"it": ["Categ.", "1", "2", "3", "4", "5", "6", "SCALA", "FULL.", "POK.", "GEN.", "GEN2"],
"pl": ["Categ.", "1", "2", "3", "4", "5", "6", "STRIT", "FULL.", "POK.", "GEN.", "GEN2"],
"vi": ["Categ.", "1", "2", "3", "4", "5", "6", "D√ÉY", "FULL.", "POK.", "GEN.", "GEN2"],
"nl": ["Categ.", "1", "2", "3", "4", "5", "6", "STRAAT", "FULL.", "POK.", "GEN.", "GEN2"],
"ro": ["Categ.", "1", "2", "3", "4", "5", "6", "»òCARƒÇ", "FULL.", "POK.", "GEN.", "GEN2"],
"zh": ["Á±ªÂà´", "‰∏ÄÁÇπ", "‰∏§ÁÇπ", "‰∏âÁÇπ", "ÂõõÁÇπ", "‰∫îÁÇπ", "ÂÖ≠ÁÇπ", "È°∫Â≠ê", "Êª°Â†Ç", "ÂõõÊù°", "Â∞Ü", "Â∞Ü‰∫å"] // Corregido "Â∞Ü2" a "Â∞Ü‰∫å"
};
const score_options = {
"1": [0,1,2,3,4,5], "2": [0,2,4,6,8,10], "3": [0,3,6,9,12,15],
"4": [0,4,8,12,16,20], "5": [0,5,10,15,20,25], "6": [0,6,12,18,24,30],
"7": [0,20,25], "8": [0,30,35], "9": [0,40,45], "10": [0,50], "11": [0,100]
};
const max_points_map = [0, 5, 10, 15, 20, 25, 30, 25, 35, 45, 50, 100];
const hex_colors = {
"white": "#FFFFFF", "black": "#000000", "red": "#FF0000", "blue": "#0000FF",
"green": "#00FF00", "orange": "#FFA500", "purple": "#800080", "brown": "#8B4513",
"magenta": "#FF00FF", "cyan": "#00FFFF", "yellow": "#FFFF00", "deeppink": "#FF1493",
"gold": "#FFD700", "turquoise": "#40E0D0", "silver": "#C0C0C0"
};
// ----------------- ESTADO GLOBAL -----------------
let app = {
lang: "es",
jugadores: ["", ""],
jugador_colores: ["red", "blue"],
puntajes: {},
current_turn: 0,
dead_players: new Set(),
victoria_mostrada: false,
leader_idx: -1,
game_started: false // Para controlar si el juego ya ha comenzado
};
// ----------------- UTILIDADES -----------------
function getText(key) {
return (translations[app.lang] || translations["es"])[key] || key;
}
function getCategories() {
return categories_translations[app.lang] || categories_translations["es"];
}
// Funci√≥n para traducir n√∫meros al idioma actual
function translateNumber(num) {
if (num === undefined || num === null || num === "" || num === "X") return num;
num = parseInt(num);
if (isNaN(num)) return num.toString();
// Chino - sistema completo de n√∫meros
if (app.lang === "zh") {
const chineseNumbers = {
0: "Èõ∂", 1: "‰∏Ä", 2: "‰∫å", 3: "‰∏â", 4: "Âõõ", 5: "‰∫î", 6: "ÂÖ≠", 7: "‰∏É", 8: "ÂÖ´", 9: "‰πù",
10: "ÂçÅ", 11: "ÂçÅ‰∏Ä", 12: "ÂçÅ‰∫å", 13: "ÂçÅ‰∏â", 14: "ÂçÅÂõõ", 15: "ÂçÅ‰∫î", 16: "ÂçÅÂÖ≠", 17: "ÂçÅ‰∏É", 18: "ÂçÅÂÖ´", 19: "ÂçÅ‰πù",
20: "‰∫åÂçÅ", 21: "‰∫åÂçÅ‰∏Ä", 22: "‰∫åÂçÅ‰∫å", 23: "‰∫åÂçÅ‰∏â", 24: "‰∫åÂçÅÂõõ", 25: "‰∫åÂçÅ‰∫î", 30: "‰∏âÂçÅ", 35: "‰∏âÂçÅ‰∫î",
40: "ÂõõÂçÅ", 45: "ÂõõÂçÅ‰∫î", 50: "‰∫îÂçÅ", 100: "‰∏ÄÁôæ"
};
return chineseNumbers[num] || num.toString();
}
// Otros idiomas pueden tener traducciones espec√≠ficas
if (app.lang === "en-US" && num === 50) return "50";
if (app.lang === "fr" && num === 0) return "z√©ro";
return num.toString();
}
// Capitalizar nombre: Primera letra may√∫scula, resto min√∫sculas
function capitalizeName(nombre) {
if (!nombre) return "";
nombre = nombre.trim();
if (nombre.length === 0) return "";
// Convertir primera letra a may√∫scula, resto a min√∫sculas
return nombre.charAt(0).toUpperCase() + nombre.slice(1).toLowerCase();
}
// Limitar a 6 caracteres y capitalizar
function formatPlayerName(nombre, num_players) {
if (!nombre) return "";
nombre = capitalizeName(nombre);
// Limitar a 6 caracteres m√°ximo
if (nombre.length > 6) {
return nombre.substring(0, 6);
}
return nombre;
}
function getHexColor(name) {
return hex_colors[name] || name;
}
// Funci√≥n estricta de color de texto: BLANCO SOLO SI EL FONDO ES NEGRO
function getTextColorForBg(bgKey) {
return (bgKey === "black") ? "white" : "black";
}
// ----------------- NAVEGACI√ìN -----------------
function navTo(screenId) {
document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
document.getElementById(screenId + '-screen').classList.add('active');
if (screenId === 'home') updateHomeText();
if (screenId === 'menu') updateMenuText();
if (screenId === 'language') initLangScreen();
if (screenId === 'anotador') updateAnotadorText();
if (screenId === 'menu') {
// Mantener los colores al volver al men√∫
restorePlayerColors();
}
}
// Restaurar colores de jugadores al volver al men√∫
function restorePlayerColors() {
playerWidgets.forEach((widget, idx) => {
if (app.jugador_colores[idx]) {
updateColorButton(widget.btn, app.jugador_colores[idx]);
}
});
}
// ----------------- HOME LOGIC -----------------
function updateHomeText() {
document.getElementById('lbl-home-welcome').innerText = getText('home_welcome');
document.getElementById('btn-home-start').innerText = getText('home_title');
document.getElementById('btn-home-lang').innerText = getText('home_lang');
}
// ----------------- LANGUAGE LOGIC -----------------
function initLangScreen() {
document.getElementById('lbl-lang-title').innerText = getText('choose_language');
document.getElementById('btn-lang-back').innerText = getText('back_to_menu');
const container = document.getElementById('lang-grid-container');
container.innerHTML = "";
const idiomas = [
["es", "Espa√±ol"], ["en", "English"], ["en-US", "English (US)"], ["pt", "Portugu√™s"],
["fr", "Fran√ßais"], ["id", "Bahasa Indonesia"], ["de", "Deutsch"], ["tr", "T√ºrk√ße"],
["it", "Italiano"], ["pl", "Polski"], ["vi", "Ti·∫øng Vi·ªát"], ["nl", "Nederlands"],
["ro", "Rom√¢nƒÉ"], ["zh", "‰∏≠Êñá"]
];
idiomas.forEach(([code, name]) => {
let btn = document.createElement('button');
btn.innerText = name;
btn.onclick = () => setLanguage(code);
container.appendChild(btn);
});
}
function setLanguage(code) {
app.lang = code;
// Mantener los nombres y colores existentes al cambiar de idioma
app.jugadores = app.jugadores.map(name => name || "");
resetPlayersUI();
navTo('home');
}
// ----------------- MENU LOGIC -----------------
let playerWidgets = [];
function updateMenuText() {
document.getElementById('lbl-menu-welcome').innerText = getText('welcome');
document.getElementById('btn-new-game').innerText = getText('new_game');
document.getElementById('btn-load-game').innerText = getText('load_game');
document.getElementById('btn-menu-back').innerText = getText('back_to_menu');
document.querySelectorAll('.player-name-input').forEach(i => i.placeholder = getText('player_name_hint'));
playerWidgets.forEach((w, idx) => {
if (app.jugador_colores[idx]) {
updateColorButton(w.btn, app.jugador_colores[idx]);
}
});
}
function resetPlayersUI() {
document.getElementById('players-container').innerHTML = "";
playerWidgets = [];
if(app.jugadores.length === 0) {
app.jugadores = ["", ""];
app.jugador_colores = ["red", "blue"];
}
for (let i=0; i<app.jugadores.length; i++) {
createPlayerWidgetRow(i);
}
}
function createPlayerWidgetRow(idx) {
const container = document.getElementById('players-container');
const row = document.createElement('div');
row.className = 'player-row';
const input = document.createElement('input');
input.type = 'text';
input.className = 'player-name-input';
input.placeholder = getText('player_name_hint');
input.maxLength = 6; // L√≠mite de 6 caracteres
input.value = app.jugadores[idx];
input.oninput = (e) => {
// Limitar a 6 caracteres y actualizar el estado
e.target.value = e.target.value.substring(0, 6);
app.jugadores[idx] = e.target.value;
};
input.onblur = (e) => {
// Aplicar formato capitalizado y limitar a 6 caracteres
app.jugadores[idx] = formatPlayerName(e.target.value, app.jugadores.length);
e.target.value = app.jugadores[idx];
};
const btnColor = document.createElement('button');
btnColor.className = 'color-btn';
// Asegurar que siempre haya un color definido
if (!app.jugador_colores[idx]) {
let availableColors = Object.keys(color_names[app.lang] || color_names["es"]);
app.jugador_colores[idx] = availableColors[idx % availableColors.length] || "red";
}
updateColorButton(btnColor, app.jugador_colores[idx]);
btnColor.onclick = () => openColorSelector(idx, btnColor);
row.appendChild(input);
row.appendChild(btnColor);
container.appendChild(row);
playerWidgets[idx] = { row, input, btn: btnColor };
}
function updateColorButton(btn, colorKey) {
let colorName = (color_names[app.lang] || color_names["es"])[colorKey] || colorKey;
btn.innerText = colorName;
btn.style.background = getHexColor(colorKey); // Override gradient
// LOGICA ESTRICTA: Negro para todos, Blanco solo para fondo Negro
btn.style.color = getTextColorForBg(colorKey);
// Ajustar borde para que se vea bien con el color plano
btn.style.border = "2px solid rgba(0,0,0,0.2)";
}
function addPlayerWidget() {
if (app.jugadores.length >= 10) {
showPopup(getText('error'), getText('max_players'));
return;
}
app.jugadores.push("");
// Asegurar un color para el nuevo jugador
let availableColors = Object.keys(color_names[app.lang] || color_names["es"]);
let newColor = availableColors[app.jugadores.length % availableColors.length] || "red";
app.jugador_colores.push(newColor);
createPlayerWidgetRow(app.jugadores.length - 1);
}
function removePlayerWidget() {
if (app.jugadores.length <= 2) {
showPopup(getText('error'), getText('min_players'));
return;
}
let idx = app.jugadores.length - 1;
let w = playerWidgets[idx];
w.row.remove();
playerWidgets.pop();
app.jugadores.pop();
app.jugador_colores.pop();
}
function openColorSelector(playerIdx, btnElement) {
const content = document.createElement('div');
content.className = 'grid-colors';
let colors = color_names[app.lang] || color_names["es"];
Object.keys(colors).forEach(k => {
let b = document.createElement('button');
b.innerText = colors[k];
b.style.background = getHexColor(k);
// LOGICA ESTRICTA TAMBIEN EN POPUP
b.style.color = getTextColorForBg(k);
b.style.border = "1px solid #555";
b.style.fontSize = "0.9rem";
b.onclick = () => {
app.jugador_colores[playerIdx] = k;
updateColorButton(btnElement, k);
closeModal();
};
content.appendChild(b);
});
showCustomModal(getText('select_color'), content);
}
// ----------------- GAME START / LOAD -----------------
function startGame() {
// Validar y formatear nombres antes de comenzar
for(let i=0; i<app.jugadores.length; i++) {
let raw = app.jugadores[i].trim();
if (!raw) raw = `J${i+1}`; // Nombre m√°s corto para ajustarse a 6 caracteres
// Formatear nombre (capitalizar y limitar)
app.jugadores[i] = formatPlayerName(raw, app.jugadores.length);
}
app.current_turn = 0;
app.puntajes = {};
app.victoria_mostrada = false;
app.dead_players = new Set();
app.leader_idx = -1;
app.game_started = true; // Marcar que el juego ha comenzado
buildTable();
navTo('anotador');
updateTurnLabel();
updateLeaderCrown(); // Esto no mostrar√° la corona al inicio porque no hay puntajes
saveGame(); // Guardar el estado inicial con los nombres y colores correctos
}
function loadGame() {
let saved = localStorage.getItem('generala_secure_data');
if (!saved) {
showPopup(getText('error'), getText('no_saved_game'));
return;
}
if (loadGameSecure()) {
// Al cargar, formatear los nombres correctamente
app.jugadores = app.jugadores.map(name => formatPlayerName(name, app.jugadores.length));
resetPlayersUI();
app.jugadores.forEach((n, i) => {
if(playerWidgets[i]) playerWidgets[i].input.value = n;
});
navTo('anotador');
buildTable();
Object.keys(app.puntajes).forEach(key => {
let cell = document.getElementById('cell-' + key);
if(cell) {
if (key.includes('-')) {
let [player, cat] = key.split('-');
let value = app.puntajes[key];
cell.innerText = value === "X" ? "X" : translateNumber(value);
}
}
});
updateTotals();
// Marcar que el juego ha comenzado (estamos en una partida cargada)
app.game_started = true;
updateLeaderCrown();
checkVictory();
updateTurnLabel();
}
}
function saveGame() {
saveGameSecure();
}
// ----------------- ANOTADOR LOGIC -----------------
function updateAnotadorText() {
document.getElementById('btn-anotador-back').innerText = getText('back_to_menu');
updateTurnLabel();
}
function updateTurnLabel() {
if(app.jugadores[app.current_turn]) {
// Buscar el l√≠der actual para mostrar en el turno
let leaderName = getLeaderName();
let currentPlayer = app.jugadores[app.current_turn];
let turnText = `${getText('turn_of')} ${currentPlayer}`;
// Si el jugador actual es el l√≠der, a√±adir un indicador
if (leaderName && currentPlayer === leaderName) {
turnText += " üëë";
}
document.getElementById('turn-label').innerText = turnText;
}
}
function getLeaderName() {
let numCats = getCategories().length - 1; // Excluir "Categ."
let highestScore = -1;
let leaderIdx = -1;
// Encontrar el puntaje m√°s alto
for(let j=0; j<app.jugadores.length; j++) {
if (app.dead_players.has(j)) continue; // Ignorar jugadores eliminados
let score = parseInt(app.puntajes[`${j}-total`] || "0");
if (score > highestScore) {
highestScore = score;
leaderIdx = j;
}
}
return leaderIdx >= 0 ? app.jugadores[leaderIdx] : null;
}
function buildTable() {
const grid = document.getElementById('score-grid');
grid.innerHTML = "";
const container = document.querySelector('.score-container');
container.scrollLeft = 0; // Resetear scroll al reconstruir la tabla
const cats = getCategories();
const numPlayers = app.jugadores.length;
// Ajustar el dise√±o para mostrar siempre las primeras 4 columnas visibles
const visibleCols = Math.min(4, numPlayers);
const totalCols = numPlayers + 1; // +1 para la columna de categor√≠as
grid.style.gridTemplateColumns = `1.2fr repeat(${numPlayers}, 1fr)`;
// Crear las filas y celdas
cats.forEach((catName, rIdx) => {
// Category Label - fijar para scroll horizontal
let cLabel = document.createElement('div');
cLabel.className = 'cell header-col category-cell';
cLabel.innerText = catName;
let rowBgColor = (rIdx % 2 === 0) ? 'var(--color-row1)' : 'var(--color-row2)';
cLabel.style.backgroundColor = rowBgColor;
grid.appendChild(cLabel);
// Player Cells
for(let p=0; p<numPlayers; p++) {
let cellDiv = document.createElement('div');
cellDiv.className = 'cell';
let cKey = app.jugador_colores[p];
let cellBg = getHexColor(cKey);
// LOGICA ESTRICTA EN CELDAS
let cellTxt = getTextColorForBg(cKey);
cellDiv.style.backgroundColor = cellBg;
cellDiv.style.color = cellTxt;
cellDiv.dataset.originalColor = cKey;
if (rIdx === 0) {
// Primera fila para el nombre del jugador con espacio para la corona
cellDiv.className = 'cell player-header';
cellDiv.innerText = formatPlayerName(app.jugadores[p], numPlayers);
cellDiv.id = `header-p-${p}`;
cellDiv.dataset.originalColor = cKey;
cellDiv.style.position = 'relative';
// Espacio para la corona arriba
cellDiv.style.height = '85px';
cellDiv.style.display = 'flex';
cellDiv.style.flexDirection = 'column';
cellDiv.style.justifyContent = 'flex-end';
} else {
let btn = document.createElement('button');
btn.className = 'cell-btn';
btn.id = `cell-${p}-${rIdx-1}`; // Ajustar √≠ndice para categor√≠as
btn.innerText = translateNumber(0);
btn.onclick = () => selectScore(p, (rIdx-1).toString());
btn.style.whiteSpace = 'nowrap';
btn.style.overflow = 'hidden';
btn.style.textOverflow = 'ellipsis';
cellDiv.appendChild(btn);
}
grid.appendChild(cellDiv);
}
});
// A√±adir fila de TOTAL al final
let totalLabel = document.createElement('div');
totalLabel.className = 'cell header-col category-cell';
totalLabel.innerText = "TOTAL";
totalLabel.style.backgroundColor = 'var(--color-row1)';
grid.appendChild(totalLabel);
for(let p=0; p<numPlayers; p++) {
let totalCell = document.createElement('div');
totalCell.className = 'cell';
totalCell.id = `total-${p}`;
totalCell.innerText = translateNumber(0);
let cKey = app.jugador_colores[p];
totalCell.style.backgroundColor = getHexColor(cKey);
totalCell.style.color = getTextColorForBg(cKey);
grid.appendChild(totalCell);
}
// No mostrar la corona al inicio del juego
if (app.game_started) {
updateLeaderCrown();
}
}
function selectScore(playerIdx, catKey) {
if (playerIdx !== app.current_turn) {
let target = app.jugadores[playerIdx];
let current = app.jugadores[app.current_turn];
let msg = getText('confirm_turn').replace('{target}', target).replace('{current}', current);
showConfirm(msg, () => openScorePopup(playerIdx, catKey));
} else {
openScorePopup(playerIdx, catKey);
}
}
function openScorePopup(playerIdx, catKey) {
let cats = getCategories().slice(1); // Excluir "Categ."
let catName = cats[parseInt(catKey)] || "?";
let title = `${app.jugadores[playerIdx]} - ${catName}`;
let pts = score_options[parseInt(catKey)+1] || [0,1,2,3];
let scratch = getText('scratch');
let content = document.createElement('div');
content.className = 'grid-scores';
[...pts, "X"].forEach(val => {
let b = document.createElement('button');
b.className = 'score-val-btn';
// Para idiomas como chino, usar los n√∫meros traducidos
let displayVal = (val === "X") ? scratch : translateNumber(val);
b.innerText = (val === "X") ? "X" : displayVal;
b.style.color = "#3E2723"; // Color de texto para mejor visibilidad
b.style.borderColor = "2px solid var(--color-gold)"; // Borde dorado antiguo
b.onclick = () => confirmScore(playerIdx, catKey, (val === "X" ? "X" : val.toString()));
content.appendChild(b);
});
showCustomModal(getText('select_score') + ": " + title, content, true);
}
function confirmScore(playerIdx, catKey, val) {
closeModal();
let cellBtn = document.getElementById(`cell-${playerIdx}-${catKey}`);
let prev = cellBtn.innerText;
cellBtn.innerText = val === "X" ? "X" : translateNumber(val);
app.puntajes[`${playerIdx}-${catKey}`] = val;
// Auto-scratch Gen2 if Gen is scratched
if (catKey === "9" && val === "X") {
let gen2Cell = document.getElementById(`cell-${playerIdx}-10`);
if (gen2Cell) {
gen2Cell.innerText = "X";
app.puntajes[`${playerIdx}-10`] = "X";
}
}
updateTotals();
updateLeaderCrown();
saveGame();
checkVictory();
if (playerIdx === app.current_turn && prev === translateNumber(0) && val !== "0") {
let totalP = app.jugadores.length;
let next = (playerIdx + 1) % totalP;
while (app.dead_players.has(next)) {
next = (next + 1) % totalP;
if (next === playerIdx) break;
}
app.current_turn = next;
updateTurnLabel();
}
}
function updateTotals() {
let numCats = getCategories().length - 1; // Excluir "Categ."
for(let j=0; j<app.jugadores.length; j++) {
let total = 0;
for(let i=0; i<numCats; i++) {
let val = app.puntajes[`${j}-${i}`];
if (val && val !== "X") {
total += parseInt(val);
}
}
let totalCell = document.getElementById(`total-${j}`);
if(totalCell) {
totalCell.innerText = translateNumber(total);
app.puntajes[`${j}-total`] = total.toString();
}
}
}
function updateLeaderCrown() {
// Remover coronas existentes
document.querySelectorAll('.leader-crown').forEach(el => {
el.classList.add('crown-disappear');
// Remover despu√©s de la animaci√≥n
setTimeout(() => {
if (el.parentNode && el.parentNode.contains(el)) {
el.parentNode.removeChild(el);
}
}, 500);
});
// Solo mostrar corona despu√©s de que el juego ha comenzado y hay puntajes
if (!app.game_started) return;
let numCats = getCategories().length - 1; // Excluir "Categ."
let highestScore = -1;
let leaders = [];
// Encontrar el puntaje m√°s alto
for(let j=0; j<app.jugadores.length; j++) {
if (app.dead_players.has(j)) continue; // Ignorar jugadores eliminados
let score = parseInt(app.puntajes[`${j}-total`] || "0");
if (score > highestScore) {
highestScore = score;
leaders = [j];
} else if (score === highestScore && score > 0) {
leaders.push(j);
}
}
// Solo agregar corona si hay un puntaje positivo
if (highestScore <= 0) return;
// Agregar corona a cada l√≠der (en caso de empate), ahora arriba del nombre
leaders.forEach(leaderIdx => {
let header = document.getElementById(`header-p-${leaderIdx}`);
if (header) {
let crown = document.createElement('div');
crown.className = 'leader-crown';
crown.innerHTML = 'üëë';
// A√±adir animaci√≥n de aparici√≥n
setTimeout(() => {
crown.classList.add('crown-appear');
}, 100);
header.appendChild(crown); // La corona ahora se agrega sobre el nombre, no lo tapa
}
// Actualizar el turno para mostrar qui√©n es el l√≠der
updateTurnLabel();
});
}
function checkVictory() {
app.dead_players.clear();
let numCats = getCategories().length - 1; // Excluir "Categ."
let best = 0;
for(let j=0; j<app.jugadores.length; j++) {
let s = parseInt(app.puntajes[`${j}-total`] || "0");
if (s > best) best = s;
}
for(let j=0; j<app.jugadores.length; j++) {
let currentScore = parseInt(app.puntajes[`${j}-total`] || "0");
let maxRemaining = 0;
for(let i=0; i<numCats; i++) {
let val = app.puntajes[`${j}-${i}`];
if (!val || val === "0") {
maxRemaining += max_points_map[i+1]; // Ajustar √≠ndice por categor√≠as
}
}
// L√≥gica de eliminaci√≥n
if ((currentScore + maxRemaining) < best) {
app.dead_players.add(j);
applyDeadStyle(j, true);
} else {
applyDeadStyle(j, false);
}
}
let vivos = app.jugadores.map((_, i) => i).filter(i => !app.dead_players.has(i));
// Verificar si alg√∫n jugador ha completado todas sus categor√≠as
let completedCategories = [];
let allCategoriesFilled = true;
for(let j=0; j<app.jugadores.length; j++) {
if (app.dead_players.has(j)) continue;
let completed = true;
for(let i=0; i<numCats; i++) {
let val = app.puntajes[`${j}-${i}`];
if (!val || val === "0") {
completed = false;
allCategoriesFilled = false;
}
}
if (completed) completedCategories.push(j);
}
// Si todos completaron todas las categor√≠as
if (allCategoriesFilled && !app.victoria_mostrada) {
app.victoria_mostrada = true;
// Encontrar los puntajes m√°s altos entre los jugadores vivos
let maxScore = -1;
let winners = [];
for(let j of vivos) {
let score = parseInt(app.puntajes[`${j}-total`] || "0");
if (score > maxScore) {
maxScore = score;
winners = [j];
} else if (score === maxScore) {
winners.push(j);
}
}
// Mostrar animaci√≥n para ganadores (puede ser empate o individual)
showWinnerAnimation(winners);
return;
}
// Verificar si hay un ganador definitivo (imposible que otros lo alcancen)
if (vivos.length === 1 && !app.victoria_mostrada) {
app.victoria_mostrada = true;
showWinnerAnimation([vivos[0]]);
return;
}
// Verificar si alg√∫n jugador vivo tiene un puntaje tan alto que es imposible de alcanzar
for(let j of vivos) {
let currentScore = parseInt(app.puntajes[`${j}-total`] || "0");
let maxRemainingForOthers = 0;
for(let i=0; i<numCats; i++) {
// Sumar el m√°ximo posible para las categor√≠as restantes
maxRemainingForOthers += max_points_map[i+1];
}
// Verificar si alg√∫n otro jugador puede alcanzarlo
let canBeBeaten = false;
for(let k of vivos) {
if (k === j) continue;
let otherScore = parseInt(app.puntajes[`${k}-total`] || "0");
if (otherScore + maxRemainingForOthers >= currentScore) {
canBeBeaten = true;
break;
}
}
if (!canBeBeaten && !app.victoria_mostrada) {
app.victoria_mostrada = true;
showWinnerAnimation([j]);
return;
}
}
}
function applyDeadStyle(playerIdx, isDead) {
// Determinar tipo de l√≠nea seg√∫n color original
// Si el jugador era NEGRO -> L√≠nea BLANCA
// Si el jugador era cualquier otro -> L√≠nea NEGRA
const originalColor = app.jugador_colores[playerIdx];
const lineClass = (originalColor === 'black') ? 'dead-line-white' : 'dead-line-black';
// Elementos a afectar: Header, Total y Celdas
const elements = [];
elements.push(document.getElementById(`header-p-${playerIdx}`));
elements.push(document.getElementById(`total-${playerIdx}`));
let numCats = getCategories().length - 1; // Excluir "Categ."
for(let i=0; i<numCats; i++) {
let btn = document.getElementById(`cell-${playerIdx}-${i}`);
if(btn) elements.push(btn.parentElement);
}
elements.forEach(el => {
if(!el) return;
if(isDead) {
el.classList.add('dead-cell');
el.classList.add(lineClass);
} else {
el.classList.remove('dead-cell');
el.classList.remove('dead-line-black');
el.classList.remove('dead-line-white');
}
// Remover corona si est√° eliminado
if(isDead) {
let crown = el.querySelector('.leader-crown');
if(crown) crown.remove();
}
});
}
// ----------------- POPUP SYSTEM -----------------
function showPopup(title, bodyText) {
document.getElementById('modal-title').innerText = title;
document.getElementById('modal-body').innerHTML = "";
let p = document.createElement('p');
p.innerText = bodyText;
p.style.color = 'var(--color-gold)'; // Color dorado para el texto del error
document.getElementById('modal-body').appendChild(p);
let btnBox = document.getElementById('modal-buttons');
btnBox.innerHTML = '<button onclick="closeModal()">OK</button>';
document.getElementById('modal-generic').style.display = 'flex';
}
function showConfirm(text, onYes) {
document.getElementById('modal-title').innerText = getText('confirm');
// Cambiar el color del texto a dorado antiguo
document.getElementById('modal-title').style.color = 'var(--color-gold)';
document.getElementById('modal-body').innerText = text;
// Cambiar el color del texto a dorado antiguo
document.getElementById('modal-body').style.color = 'var(--color-gold)';
let btnBox = document.getElementById('modal-buttons');
btnBox.innerHTML = "";
let bYes = document.createElement('button');
bYes.innerText = getText('yes');
bYes.onclick = () => { closeModal(); onYes(); };
let bNo = document.createElement('button');
bNo.innerText = getText('no');
bNo.onclick = closeModal;
btnBox.appendChild(bYes);
btnBox.appendChild(bNo);
document.getElementById('modal-generic').style.display = 'flex';
}
function showCustomModal(title, contentElement, isScoreModal = false) {
document.getElementById('modal-title').innerText = title;
// Cambiar el color del t√≠tulo a dorado antiguo si es un modal de puntuaci√≥n
if (isScoreModal) {
document.getElementById('modal-title').style.color = 'var(--color-gold)';
} else {
document.getElementById('modal-title').style.color = '#3E2723';
}
let body = document.getElementById('modal-body');
body.innerHTML = "";
body.appendChild(contentElement);
document.getElementById('modal-buttons').innerHTML = '<button onclick="closeModal()">Cancelar</button>';
document.getElementById('modal-generic').style.display = 'flex';
}
function closeModal() {
document.getElementById('modal-generic').style.display = 'none';
// Restaurar el color del t√≠tulo del modal
document.getElementById('modal-title').style.color = '#3E2723';
}
// ----------------- ANIMACI√ìN DE VICTORIA -----------------
function showWinnerAnimation(winnerIndices) {
// Crear overlay brillante
let overlay = document.createElement('div');
overlay.id = 'winner-overlay';
let isTie = winnerIndices.length > 1;
let winnerNames = winnerIndices.map(idx => app.jugadores[idx]);
// Texto del ganador o empate
let winnerTitle = document.createElement('h1');
winnerTitle.className = 'winner-title';

// Mensaje de empate simplificado
let winnerMessageText = '';
if (isTie) {
winnerMessageText = `${winnerNames.join(', ')} ${getText('tie_message')}`;
} else {
winnerMessageText = `${winnerNames[0]} ${getText('winner_msg')}`;
}

winnerTitle.innerHTML = winnerMessageText;

// Mensaje adicional
let message = document.createElement('div');
message.className = 'winner-message';
message.innerHTML = isTie ? getText('tie_message').split(',')[0] : getText('congrats');

// Contenedor de resumen
let summaryContainer = document.createElement('div');
summaryContainer.className = 'winner-summary';
summaryContainer.innerHTML = `<h3 style="color: gold; margin: 0 0 10px 0; text-shadow: 0 0 5px gold;">${getText('end_game')}</h3>`;

// Crear resumen de puntajes
let summaryGrid = document.createElement('div');
summaryGrid.className = 'summary-grid';
summaryGrid.style.gridTemplateColumns = `1.2fr repeat(${app.jugadores.length}, 1fr)`;

// Header Players
let corner = document.createElement('div');
corner.className = 'summary-cell summary-header';
corner.innerText = getCategories()[0]; // "Categ." o versi√≥n abreviada
summaryGrid.appendChild(corner);

app.jugadores.forEach((p, i) => {
let pc = document.createElement('div');
pc.className = 'summary-cell summary-header';
// Mostrar nombre formateado
pc.innerText = formatPlayerName(p, app.jugadores.length);
pc.style.backgroundColor = getHexColor(app.jugador_colores[i]);
pc.style.color = getTextColorForBg(app.jugador_colores[i]);
summaryGrid.appendChild(pc);
});

// Rows
const cats = getCategories();
cats.forEach((catName, rIdx) => {
// Category Label
if (rIdx === 0) return; // Skip the first "Categ." header

let cLabel = document.createElement('div');
cLabel.className = 'summary-cell summary-header';
cLabel.innerText = catName;
summaryGrid.appendChild(cLabel);

// Player Cells
for(let p=0; p<app.jugadores.length; p++) {
let cell = document.createElement('div');
cell.className = 'summary-cell';
let cKey = app.jugador_colores[p];
cell.style.backgroundColor = getHexColor(cKey);
cell.style.color = getTextColorForBg(cKey);
let value = "0";
// Categor√≠as
value = app.puntajes[`${p}-${rIdx-1}`] || "0";
// Traducir n√∫meros para todos los idiomas
if (value !== "X") {
value = translateNumber(value);
}
cell.innerText = value;
// Si es el/los ganador/es, resaltar
if (winnerIndices.includes(p)) {
cell.style.border = "2px solid gold";
cell.style.fontWeight = "bold";
}
summaryGrid.appendChild(cell);
}
});

// Fila de TOTAL al final
let totalLabel = document.createElement('div');
totalLabel.className = 'summary-cell summary-header';
totalLabel.innerText = "TOTAL";
summaryGrid.appendChild(totalLabel);
for(let p=0; p<app.jugadores.length; p++) {
let cell = document.createElement('div');
cell.className = 'summary-cell';
let cKey = app.jugador_colores[p];
cell.style.backgroundColor = getHexColor(cKey);
cell.style.color = getTextColorForBg(cKey);
let total = app.puntajes[`${p}-total`] || "0";
cell.innerText = translateNumber(total);
// Si es el/los ganador/es y est√° en la fila de total, resaltar
if (winnerIndices.includes(p)) {
cell.style.border = "2px solid gold";
cell.style.fontWeight = "bold";
cell.style.fontSize = "1.1rem";
}
summaryGrid.appendChild(cell);
}

summaryContainer.appendChild(summaryGrid);

// Bot√≥n para cerrar
let closeButton = document.createElement('button');
closeButton.className = 'close-btn';
closeButton.innerText = getText('back_to_menu');
closeButton.onclick = function() {
document.body.removeChild(overlay);
navTo('menu');
// Resetear el estado del juego
app.game_started = false;
};

// Agregar elementos al overlay
overlay.appendChild(winnerTitle);
overlay.appendChild(message);
overlay.appendChild(summaryContainer);
overlay.appendChild(closeButton);
document.body.appendChild(overlay);

// Crear confeti
createConfetti(overlay);

// Sonido de victoria
playVictorySound();

// Ajustar el layout para evitar superposici√≥n
setTimeout(() => {
let winnerMessage = document.querySelector('.winner-message');
let closeButton = document.querySelector('.close-btn');
if (winnerMessage && closeButton) {
winnerMessage.style.marginBottom = '20px';
closeButton.style.marginTop = '30px';
}
}, 100);
}

function createConfetti(container) {
const colors = ['#FFD700', '#FF6347', '#32CD32', '#1E90FF', '#BA55D3'];
const count = window.innerWidth < 480 ? 50 : 100;
for (let i = 0; i < count; i++) {
let confetti = document.createElement('div');
confetti.className = 'confetti';
confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
confetti.style.left = Math.random() * 100 + '%';
confetti.style.width = Math.random() * 10 + 5 + 'px';
confetti.style.height = confetti.style.width;
confetti.style.transform = 'rotate(' + Math.random() * 360 + 'deg)';
confetti.style.position = 'absolute';
confetti.style.top = '-20px';
confetti.style.opacity = Math.random();
confetti.style.animation = 'confettiFall ' + (Math.random() * 3 + 2) + 's linear forwards';
confetti.style.animationDelay = Math.random() * 3 + 's';
container.appendChild(confetti);
// Remover confeti despu√©s de la animaci√≥n para no saturar el DOM
setTimeout(() => {
if (confetti.parentNode) {
confetti.parentNode.removeChild(confetti);
}
}, 6000);
}
}

function playVictorySound() {
if (audioCtx.state === 'suspended') audioCtx.resume();
// Tonos ascendentes para celebraci√≥n
const now = audioCtx.currentTime;
const notes = [440, 554.37, 660, 880, 1320]; // A4, C#5, E5, A5, E6
notes.forEach((freq, i) => {
const oscillator = audioCtx.createOscillator();
const gainNode = audioCtx.createGain();
oscillator.connect(gainNode);
gainNode.connect(audioCtx.destination);
oscillator.type = 'sine';
oscillator.frequency.setValueAtTime(freq, now + i * 0.15);
gainNode.gain.setValueAtTime(0, now + i * 0.15);
gainNode.gain.linearRampToValueAtTime(0.3, now + i * 0.15 + 0.05);
gainNode.gain.exponentialRampToValueAtTime(0.01, now + i * 0.15 + 0.4);
oscillator.start(now + i * 0.15);
oscillator.stop(now + i * 0.15 + 0.4);
});
}

// Inicializar Home
resetPlayersUI();
updateHomeText();

// Forzar HTTPS en producci√≥n
if (window.location.protocol !== 'https:' &&
window.location.hostname !== 'localhost' &&
window.location.hostname !== '127.0.0.1') {
window.location.protocol = 'https:';
}

// ----------------- INICIALIZACI√ìN -----------------
// Llamar a la funci√≥n para verificar autenticaci√≥n al cargar la p√°gina
document.addEventListener('DOMContentLoaded', function() {
checkAuthentication();
// Registrar service worker para PWA
if ('serviceWorker' in navigator) {
window.addEventListener('load', () => {
navigator.serviceWorker.register('/sw.js')
.then(registration => {
console.log('ServiceWorker registrado con √©xito:', registration.scope);
})
.catch(error => {
console.log('Error registrando ServiceWorker:', error);
});
});
}
});

// Manejar cambio de tama√±o de ventana para ajustar el dise√±o
window.addEventListener('resize', function() {
if (document.getElementById('anotador-screen').classList.contains('active')) {
buildTable();
updateLeaderCrown();
}
});

// Asegurar que la columna de categor√≠as siga fija durante el scroll horizontal
document.querySelector('.score-container').addEventListener('scroll', function() {
const grid = document.getElementById('score-grid');
const categoryCells = grid.querySelectorAll('.category-cell');
const scrollLeft = this.scrollLeft;
// Ajustar la sombra para indicar que hay contenido oculto
if (scrollLeft > 0) {
grid.style.boxShadow = 'inset 10px 0 15px -10px rgba(0,0,0,0.5)';
} else {
grid.style.boxShadow = 'inset 0 0 10px rgba(0,0,0,0.5)';
}
});
</script>
</body>
</html>
